<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxC - Nigeria's P.I.T Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <style>
/* -------------------- Color Palette: Vibrant Primary Green #28A745 -------------------- */

/* -------------------- Global Reset & Typography -------------------- */
body {
    font-family: 'Inter', sans-serif;
    background-color: #F8F9FA;
    color: #343A40;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    scroll-behavior: smooth;
}
.container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 20px;
}
h2.section-title {
    font-size: 2rem;
    color: #28A745; /* Primary Green */
    margin-bottom: 30px;
    text-align: center;
    font-weight: 700;
}
/* -------------------- Hero Section Styles -------------------- */
.hero-section {
    padding: 40px 20px; 
    text-align: center;
    background-color: #FFFFFF; /* White background to remove green */
    border-bottom: 5px solid #28A745; /* Primary Green */
    margin-bottom: 40px;
    border-radius: 10px;
}
.hero-section h1 {
    font-size: 3rem;
    color: #343A40;
    margin-bottom: 10px; 
    font-weight: 700;
}
.hero-section p {
    font-size: 1.25rem;
    color: #555;
    max-width: 800px;
    margin: 0 auto 20px; 
}
.cta-button {
    display: inline-block;
    padding: 12px 25px;
    background-color: #28A745; /* Primary Green */
    color: white;
    text-decoration: none;
    border-radius: 50px;
    font-weight: 600;
    transition: background-color 0.3s, transform 0.2s;
}
.cta-button:hover {
    background-color: #218838; /* Darker Green (Hover) */
    transform: translateY(-2px);
}

/* -------------------- Header & Navigation (HEIGHT REDUCED) -------------------- */
.main-header {
    background-color: #ffffff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    padding: 5px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
}
.logo {
    font-size: 1.8rem;
    font-weight: 700;
    color: #28A745; /* Primary Green */
    text-decoration: none;
    display: flex;
    align-items: center; 
    gap: 8px;
}
.logo-icon {
    height: 24px;
    width: 24px;
}
.desktop-nav a, .mobile-menu a {
    text-decoration: none;
    color: #343A40;
    padding: 8px 15px;
    transition: color 0.3s;
    font-weight: 600;
}
.desktop-nav a:hover, .mobile-menu a:hover {
    color: #28A745; /* Primary Green */
}
.desktop-nav {
    display: none; 
}
/* Hamburger Styles (Fixed) */
#hamburger {
    background: none;
    border: none;
    cursor: pointer;
    display: block; 
    padding: 0;
    width: 30px;
    height: 20px;
    position: relative;
    top: 0;
}
.hamburger-box {
    width: 100%;
    height: 100%;
    display: block;
    position: relative;
}
.hamburger-inner, .hamburger-inner::before, .hamburger-inner::after {
    position: absolute;
    height: 2px;
    width: 100%;
    background-color: #343A40;
    transition: transform 0.3s ease, opacity 0.3s ease;
    left: 0;
}
.hamburger-inner {
    top: 50%;
    transform: translateY(-50%);
}
.hamburger-inner::before { 
    content: '';
    top: -8px;
}
.hamburger-inner::after { 
    content: '';
    bottom: -8px;
}

/* Active state for animation */
.hamburger.is-active .hamburger-inner { 
    transform: translateY(-50%) rotate(45deg); 
}
.hamburger.is-active .hamburger-inner::before { 
    opacity: 0;
}
.hamburger.is-active .hamburger-inner::after { 
    transform: translateY(0) rotate(-90deg);
    top: 0;
}

.mobile-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: #fff;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 10px 0;
    flex-direction: column;
    z-index: 99;
}
.mobile-menu[open] {
    display: flex;
}
.mobile-menu a {
    padding: 10px 20px;
    border-bottom: 1px solid #eee;
}

/* -------------------- General Card & Form Styles -------------------- */
.content-section {
    padding: 40px 0;
}
.card-form, .card-output {
    background-color: #FFFFFF;
    padding: 30px; 
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    margin-bottom: 30px;
}
.section-divider {
    text-align: center;
    margin: 30px 0 20px;
    font-weight: 600;
    color: #28A745; /* Primary Green */
    position: relative;
}
.section-divider::before, .section-divider::after {
    content: '';
    position: absolute;
    top: 50%;
    width: 35%;
    height: 1px;
    background: #e0e0e0;
}
.section-divider::before { left: 0; }
.section-divider::after { right: 0; }

/* Card Content Spacing & Centering */
.card-form .container-content { 
    max-width: 800px;
    margin: 0 auto;
    padding: 0 20px;
}
/* CRITICAL FIX: Ensure all fields are flush left */
.card-form .input-row,
.card-form .input-group,
.card-form .add-income-btn,
.card-form .calculate-btn,
.card-form .income-sources-list,
.card-form .section-divider {
    margin-left: 0; 
    margin-right: 0;
    max-width: 100%; 
}

/* -------------------- Input Groups -------------------- */
.input-group, .input-row {
    margin-bottom: 20px;
}
.input-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #555;
}
input[type="text"], input[type="email"], select {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 1rem;
    transition: border-color 0.3s;
}
input:focus, select:focus {
    border-color: #28A745; /* Primary Green */
    outline: none;
    box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.25); /* Primary Green (with transparency) */
}

/* -------------------- Buttons -------------------- */
.calculate-btn {
    display: block;
    width: 100%;
    padding: 15px;
    background-color: #28A745; /* Primary Green */
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-top: 30px;
}
.calculate-btn:hover {
    background-color: #218838; /* Darker Green (Hover) */
}
.add-income-btn {
    background: none;
    border: 1px dashed #28A745; /* Primary Green */
    color: #28A745; /* Primary Green */
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    margin-top: 10px;
    transition: background-color 0.3s, color 0.3s;
}
.add-income-btn:hover {
    background-color: #e6ffe6; /* Light green hover */
}
/* Reset Button Default (Black) */
.reset-btn {
    display: block;
    width: 100%;
    padding: 15px;
    background-color: #e5e5e5;
    color: rgb(0, 0, 0);             
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-top: 10px; /* Space it 10px below the Calculate button */
}

/* Reset Button Hover (Brighter Shade of Black / Dark Gray) */
.reset-btn:hover {
    background-color: #343A40; /* Darker Grey for Hover */
}

/* -------------------- How It Works Section -------------------- */
.steps-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 20px;
}
.step-card {
    background: #FFFFFF;
    padding: 25px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    border-top: 5px solid #28A745; /* Primary Green */
}
.step-number {
    display: inline-block;
    width: 40px;
    height: 40px;
    line-height: 40px;
    border-radius: 50%;
    background-color: #28A745; /* Primary Green */
    color: white;
    font-weight: 700;
    margin-bottom: 10px;
}
.step-card h3 {
    color: #343A40;
    margin-top: 0;
}

/* -------------------- Income Source Block (Template Styling) -------------------- */
.income-source-block {
    border: 1px solid #ddd;
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 8px;
    position: relative;
    background-color: #fefefe;
}
/* Income Source Alignment Fix: Use flexbox and reset margins/paddings */
.income-source-block .input-row {
    display: flex;
    gap: 20px;
    margin-left: 0;
    margin-right: 0;
    padding: 0;
}
.income-source-block .input-row .input-group {
    flex: 1;
    margin-left: 0;
    margin-right: 0;
    padding: 0;
}
.gross-income-container {
    margin-left: 0; 
    margin-right: 0;
    padding: 0;
}
.income-source-block > * {
    margin-left: 0;
    margin-right: 0;
    padding-left: 0;
    padding-right: 0;
}
.income-source-block .income-header {
    margin-bottom: 15px;
    padding-bottom: 10px;
    margin-left: initial;
    margin-right: initial;
}
.income-source-block .remove-btn {
    padding-right: 0;
}
/* End of Income Source Alignment Fix */

.income-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}
.income-header h3 {
    margin: 0;
    font-size: 1.2rem;
    color: #28A745; /* Primary Green */
}
.income-index {
    display: inline-block;
    background: #28A745; /* Primary Green */
    color: white;
    border-radius: 4px;
    padding: 2px 8px;
    margin-right: 10px;
    font-size: 0.9rem;
}
.remove-btn {
    background: none;
    border: none;
    color: #dc3545;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    transition: color 0.3s;
    padding: 0;
}
.remove-btn:hover {
    color: #a71d2a;
}

/* Redefine grid for general input-rows */
.input-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    align-items: flex-start;
}
/* DEDUCTION FIELDS ALIGNMENT FIX */
.deductions-row { 
    display: flex; 
    gap: 20px;
    margin-left: 0; 
    margin-right: 0;
    margin-bottom: 20px; 
    padding: 0;
}
.deductions-row .input-group {
    flex: 1; 
    margin-bottom: 0;
    padding: 0;
}
.card-form .input-group:last-of-type {
    margin-left: 0;
    margin-right: 0;
}
/* End of Deduction Alignment Fix */

.gross-income-container, .wht-row {
    display: flex; 
    flex-direction: column;
}
/* Monthly Income Table Look (using your .monthly-income-row) */
.monthly-income-container {
    padding: 10px;
    border: 1px solid #eee;
    border-radius: 6px;
    background-color: #fcfcfc;
}
.monthly-income-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 10px;
}
.monthly-income-row label {
    font-size: 0.85rem;
    margin-bottom: 5px;
    text-align: center;
}
.monthly-income-row input {
    text-align: center;
}
.monthly-total {
    text-align: right;
    font-weight: 700;
    color: #28A745; /* Primary Green */
    padding-top: 10px;
    border-top: 1px solid #eee;
    margin-top: 10px;
}
.tooltip {
    position: relative;
    display: inline-block;
    cursor: help;
}
.tooltip .tooltiptext {
    visibility: hidden;
    width: 200px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px;
    position: absolute;
    z-index: 1;
    bottom: 125%; 
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 0.85rem;
}
.tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
}

/* -------------------- Output & Report Section -------------------- */
.message-area {
    padding: 10px;
    background-color: #e6ffe6; /* Light green for info/success messages */
    color: #218838; /* Darker green text */
    border: 1px solid #28A745; /* Primary Green border */
    border-radius: 5px;
    margin-bottom: 20px;
    font-weight: 600;
    text-align: center;
}
.tax-summary-box {
    background-color: #e9ecef; /* Light grey box for summary */
    padding: 20px;
    border-radius: 6px;
    font-size: 1.1rem;
    line-height: 1.8;
}
.tax-summary-box strong {
    color: #28A745; /* Primary Green */
}
.report-section {
    margin-top: 25px;
    padding-top: 15px;
    border-top: 1px dashed #ddd;
}
.report-prompt {
    font-style: italic;
    color: #6c757d;
}
.input-group-inline {
    display: flex;
    gap: 10px;
}
.input-group-inline input[type="email"] {
    flex-grow: 1;
}
.report-btn {
    background-color: #28A745; /* Primary Green */
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    white-space: nowrap;
    transition: background-color 0.3s;
}
.report-btn:hover {
    background-color: #218838; /* Darker green on hover */
}

/* -------------------- Media Queries (Responsiveness) -------------------- */
@media (min-width: 768px) {
    .desktop-nav {
        display: flex;
    }
    #hamburger {
        display: none;
    }
    .content-section {
        padding: 50px 0;
    }
    /* Adjust card padding for larger screens */
    .card-form, .card-output {
        padding: 40px;
    }
    /* Ensure deduction fields are still side-by-side on desktop */
    .deductions-row {
        flex-direction: row; 
    }
}

@media (max-width: 576px) {
    .monthly-income-row {
        grid-template-columns: repeat(2, 1fr); 
    }
    .input-group-inline {
        flex-direction: column;
    }
    /* Income Source block fixes (stacking) */
    .income-source-block .input-row {
        flex-direction: column;
        gap: 0;
    }
    .income-source-block .input-row .input-group {
        margin-bottom: 20px;
    }
    /* Deduction fields must also stack on mobile */
    .deductions-row {
        flex-direction: column;
        gap: 0;
        margin-bottom: 0; 
    }
    .deductions-row .input-group {
        margin-bottom: 20px;
    }
    
    .card-form, .card-output {
        padding: 20px;
    }
    .card-form .container-content {
        padding: 0 10px;
    }
}
</style>
</head>
<body>

    <header class="main-header">
    <a class="logo" href="index.html">
        <img src="favicon.ico" alt="TaxC Logo" class="logo-icon">
        TaxC
    </a>
        <nav class="desktop-nav">
            <a href="faq.html">Frequently Asked Questions</a>
            <a href="ebooks.html">Ebooks</a>
            <a href="#calculator">Calculator</a>
        </nav>
        <button id="hamburger" class="hamburger" onclick="toggleMobileMenu()" type="button">
            <span class="hamburger-box"><span class="hamburger-inner"></span></span>
        </button>
        <nav id="menu" class="mobile-menu nav-dropdown-menu">
            <a href="faq.html" class="nav-link">Frequently Asked Questions</a>
            <a href="ebooks.html" class="nav-link">Ebooks</a>
            <a href="#calculator" class="nav-link">Calculator</a>
        </nav>
    </header>
    <main class="container">
        
        <section class="hero-section">
            <h1>Nigerian Tax Calculator (P.I.T)</h1>
            <p>Use this calculator to accurately find out how much Personal Income Tax (P.I.T.) you should pay. It uses the latest tax rules and automatically includes all your allowances, like for your pension, rent, and minimum tax relief.</p>
            <a href="#calculator" class="cta-button">Start Calculation Now</a>
        </section>

        <section id="how-it-works" class="content-section">
            <h2 class="section-title">💡 How Our Tax Calculator Works</h2>
            <div class="steps-container">
                <div class="step-card">
                    <span class="step-number">1</span>
                    <h3>Input Income</h3>
                    <p>Enter all income sources (Salary, Rental, Self-Employed, etc.) and choose annual or monthly frequency.</p>
                </div>
                <div class="step-card">
                    <span class="step-number">2</span>
                    <h3>Apply Deductions</h3>
                    <p>Enter your Pension contributions and Annual Rent to automatically calculate reliefs based on current tax laws.</p>
                </div>
                <div class="step-card">
                    <span class="step-number">3</span>
                    <h3>Calculate Tax</h3>
                    <p>Click *Calculate Tax* to instantly see your estimated annual and monthly tax liability based on Nigerian P.I.T. Act.</p>
                </div>
            </div>
        </section>

        <hr>

        <section id="calculator" class="content-section card-form">
    <div class="container-content">  <h2 class="section-title">Tax Calculator</h2>
        
        <div id="income-sources-container" class="income-sources-list">
            </div>

        <button onclick="addIncomeSource()" class="add-income-btn">➕ Add Another Income Source</button>

        <div class="section-divider">Other Deductions & Information</div>
        <div class="input-row">
            <div class="input-group">
                <label for="pension">Annual Pension Contributions (₦)</label>
                <input type="text" id="pension" oninput="updateFormattedValue(this)" placeholder="e.g., 200,000">
            </div>
            <div class="input-group">
                <label for="rent">Annual Rent Paid (₦)</label>
                <input type="text" id="rent" oninput="updateFormattedValue(this)" placeholder="e.g., 1,500,000">
            </div>
        </div>
        
        <div class="input-group">
            <label for="state">State of Residence (For P.I.T. purposes)</label>
           <div class="input-group">
    <select id="state" name="state" required>
        <option value="" disabled selected>Select your State...</option>
        <option value="FCT Abuja">FCT Abuja</option>
        <option value="Abia">Abia</option>
        <option value="Adamawa">Adamawa</option>
        <option value="Akwa Ibom">Akwa Ibom</option>
        <option value="Anambra">Anambra</option>
        <option value="Bauchi">Bauchi</option>
        <option value="Bayelsa">Bayelsa</option>
        <option value="Benue">Benue</option>
        <option value="Borno">Borno</option>
        <option value="Cross River">Cross River</option>
        <option value="Delta">Delta</option>
        <option value="Ebonyi">Ebonyi</option>
        <option value="Edo">Edo</option>
        <option value="Ekiti">Ekiti</option>
        <option value="Enugu">Enugu</option>
        <option value="Gombe">Gombe</option>
        <option value="Imo">Imo</option>
        <option value="Jigawa">Jigawa</option>
        <option value="Kaduna">Kaduna</option>
        <option value="Kano">Kano</option>
        <option value="Katsina">Katsina</option>
        <option value="Kebbi">Kebbi</option>
        <option value="Kogi">Kogi</option>
        <option value="Kwara">Kwara</option>
        <option value="Lagos">Lagos</option>
        <option value="Nasarawa">Nasarawa</option>
        <option value="Niger">Niger</option>
        <option value="Ogun">Ogun</option>
        <option value="Ondo">Ondo</option>
        <option value="Osun">Osun</option>
        <option value="Oyo">Oyo</option>
        <option value="Plateau">Plateau</option>
        <option value="Rivers">Rivers</option>
        <option value="Sokoto">Sokoto</option>
        <option value="Taraba">Taraba</option>
        <option value="Yobe">Yobe</option>
        <option value="Zamfara">Zamfara</option>
    </select>
</div>
        
        <button onclick="calculateTax()" class="calculate-btn">Calculate Tax</button>
        <button onclick="resetForm()" class="reset-btn">Reset Calculator</button>
    </div> </section>

        <hr>

        <section id="report" class="content-section card-output">
    <h2 class="section-title">Tax Summary & Report</h2>
    
    <div id="output" style="display: none;"> 
        <div id="msg" class="message-area"></div> 
        <div id="default-report-message" style="text-align: center; color: #777; padding: 20px 10px; margin: 20px auto; max-width: 600px; border: 1px dashed #ffffff; border-radius: 8px; background-color: #f9f9f9;">
            When you calculate your tax, the detailed summary and breakdown of your estimated annual tax would appear here.
        </div>
        <div id="taxSummary"></div>
        <div class="report-section">
            <p class="report-prompt">Get a detailed PDF report for only ₦500:</p>
            <div class="input-group-inline">
                <input type="email" id="reportEmail" placeholder="Your Email Address" required>
                <button onclick="startHostedPayment()" class="report-btn">Get PDF Report</button>
            </div>
        </div>
    </div>
</section>
    </main>

    <template id="income-template">
        <div class="income-source-block" data-source-id="_INDEX">
            <div class="income-header">
                <h3>Income Source <span class="income-index">1</span></h3>
                <button type="button" class="remove-btn" onclick="removeIncomeSource(this)">Remove</button>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label for="type_INDEX">Source Type</label>
                    <select id="type_INDEX" class="income-type" onchange="handleIncomeTypeChange(this)">
                        <option value="salary">Salary/Employment</option>
                        <option value="self">Self-Employment/Business</option>
                        <option value="rental">Rental Income</option>
                        <option value="investment">Non-Investment Income</option>
                        <option value="other">Other Income</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="freq_INDEX">Frequency</label>
                    <select id="freq_INDEX" class="income-frequency" onchange="toggleMonthlyInputs(this); handleIncomeTypeChange(document.getElementById('type_INDEX'))">
                        <option value="annual">Annual Gross</option>
                        <option value="monthly">Monthly Breakdown</option>
                    </select>
                </div>
            </div>

            <div class="input-group gross-income-container">
                <label for="income_INDEX">Gross Annual Income (₦)</label>
                <div class="tooltip">
                    <input type="text" id="income_INDEX" class="gross-income" oninput="updateFormattedValue(this)">
                    <span class="tooltiptext">Total income earned in the year before taxes and deductions.</span>
                </div>
            </div>

            <div class="monthly-income-container" style="display: none;">
                <div class="input-group">
                    <label>Gross Monthly Income Breakdown (₦)</label>
                    <div class="monthly-income-row">
                        <div class="input-group">
                            <label for="jan_INDEX">Jan</label>
                            <input type="text" id="jan_INDEX" data-month="Jan" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                        <div class="input-group">
                            <label for="feb_INDEX">Feb</label>
                            <input type="text" id="feb_INDEX" data-month="Feb" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                        <div class="input-group">
                            <label for="mar_INDEX">Mar</label>
                            <input type="text" id="mar_INDEX" data-month="Mar" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                        <div class="input-group">
                            <label for="apr_INDEX">Apr</label>
                            <input type="text" id="apr_INDEX" data-month="Apr" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                        <div class="input-group">
                            <label for="may_INDEX">May</label>
                            <input type="text" id="may_INDEX" data-month="May" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                        <div class="input-group">
                            <label for="jun_INDEX">Jun</label>
                            <input type="text" id="jun_INDEX" data-month="Jun" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                        <div class="input-group">
                            <label for="jul_INDEX">Jul</label>
                            <input type="text" id="jul_INDEX" data-month="Jul" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                        <div class="input-group">
                            <label for="aug_INDEX">Aug</label>
                            <input type="text" id="aug_INDEX" data-month="Aug" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                        <div class="input-group">
                            <label for="sep_INDEX">Sep</label>
                            <input type="text" id="sep_INDEX" data-month="Sep" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                        <div class="input-group">
                            <label for="oct_INDEX">Oct</label>
                            <input type="text" id="oct_INDEX" data-month="Oct" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                        <div class="input-group">
                            <label for="nov_INDEX">Nov</label>
                            <input type="text" id="nov_INDEX" data-month="Nov" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                        <div class="input-group">
                            <label for="dec_INDEX">Dec</label>
                            <input type="text" id="dec_INDEX" data-month="Dec" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
                        </div>
                    </div>
                    <div class="monthly-total">Total Annual Income: ₦0</div>
                </div>
            </div>

            <div class="input-group wht-row" style="display: none;">
                <label for="wht_INDEX">Withholding Tax (WHT) Paid (₦)</label>
                <div class="tooltip">
                    <input type="text" id="wht_INDEX" class="wht-input" oninput="updateFormattedValue(this)" placeholder="Optional: Leave blank for default WHT calculation">
                    <span class="tooltiptext">Enter the amount of WHT deducted by payer. Defaults to statutory rate if blank.</span>
                </div>
            </div>
        </div>
    </template>

    <script>
        // Placeholder functions for showTooltip and hideTooltip
        function showTooltip(element, text) {
            if (element) {
                element.textContent = text || element.textContent;
                element.style.visibility = 'visible';
                element.style.opacity = '1';
            }
        }
        function hideTooltip(element) {
            if (element) {
                element.style.visibility = 'hidden';
                element.style.opacity = '0';
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('menu');
            const hamburger = document.getElementById('hamburger');

            if (menu.hasAttribute('open')) {
                menu.removeAttribute('open');
                hamburger.classList.remove('is-active');
            } else {
                menu.setAttribute('open', '');
                hamburger.classList.add('is-active');
                const dropdown = menu.querySelector('.nav-dropdown-menu');
                if (dropdown && dropdown.hasAttribute('open')) {
                    dropdown.removeAttribute('open');
                }
            }
        }

        function scrollToSection(event) {
            event.preventDefault();
            const href = event.target.getAttribute('href');
            const targetId = href.substring(1); 
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
            }
            toggleMobileMenu(); 
        }

        function getRawValue(inputElement) {
            if (!inputElement) return 0;
            const value = inputElement.value.replace(/[^0-9]/g, '');
            return Number(value) || 0;
        }

        function updateFormattedValue(input) {
            let value = input.value.replace(/[^0-9]/g, '');
            if (value === '') {
                input.value = '';
                return;
            }
            const rawValue = Number(value);
            input.value = rawValue.toLocaleString('en-NG');
        }

        function updateMonthlyTotal(input) {
            const block = input.closest('.income-source-block');
            if (!block) return;
            
            const monthlyInputs = block.querySelectorAll('.monthly-income-row input');
            let total = 0;
            monthlyInputs.forEach(inp => {
                const value = getRawValue(inp);
                total += value;
            });
            const totalDisplay = block.querySelector('.monthly-total');
            if (totalDisplay) {
                totalDisplay.textContent = `Total Annual Income: ₦${total.toLocaleString('en-NG')}`;
            }
        }

        function markManualEdit(input) {
            input.dataset.manual = 'true';
        }

        function handleMonthlySalaryAutoFill(block) {
            const monthlyInputs = block.querySelectorAll('.monthly-income-row input');
            const januaryInput = monthlyInputs[0];

            if (januaryInput.autoFillHandler) {
                januaryInput.removeEventListener('input', januaryInput.autoFillHandler);
                januaryInput.autoFillHandler = null;
            }
            
            if (block.querySelector('.income-type').value === 'salary' && block.querySelector('.income-frequency').value === 'monthly') {
                const autoFillHandler = (e) => {
                    if (e.isTrusted === false && e.type === 'input') return; 

                    const janValue = januaryInput.value.replace(/[^0-9]/g, '');
                    if (janValue === '') {
                        monthlyInputs.forEach((input, index) => {
                             if (index !== 0 && input.dataset.manual !== 'true') {
                                input.value = '';
                            }
                        });
                        updateMonthlyTotal(januaryInput);
                        return;
                    }

                    monthlyInputs.forEach((input, index) => {
                        if (index !== 0 && input.dataset.manual !== 'true') {
                            input.value = Number(janValue).toLocaleString('en-NG');
                            const event = new Event('input', { bubbles: true });
                            event.isTrusted = false;
                            input.dispatchEvent(event);
                        }
                    });
                    updateMonthlyTotal(januaryInput);
                };

                januaryInput.autoFillHandler = autoFillHandler;
                januaryInput.addEventListener('input', autoFillHandler);

                if (januaryInput.value) {
                    januaryInput.dispatchEvent(new Event('input'));
                }
            }
        }

        function handleIncomeTypeChange(selectEl) {
            const block = selectEl.closest('.income-source-block');
            
            toggleWhtField(selectEl);
            
            const januaryInput = block.querySelector('.monthly-income-row input[data-month="Jan"]');
            if (januaryInput) {
                if (januaryInput.autoFillHandler) {
                    januaryInput.removeEventListener('input', januaryInput.autoFillHandler);
                    januaryInput.autoFillHandler = null;
                }
                if (selectEl.value === 'salary' && block.querySelector('.income-frequency').value === 'monthly') {
                    handleMonthlySalaryAutoFill(block);
                }
            }
        }

        function toggleMonthlyInputs(selectEl) {
            const block = selectEl.closest('.income-source-block');
            const monthlyContainer = block.querySelector('.monthly-income-container');
            const grossIncomeContainer = block.querySelector('.gross-income-container');
            const typeSelect = block.querySelector('.income-type');

            if (selectEl.value === 'monthly') {
                monthlyContainer.style.display = 'block';
                grossIncomeContainer.style.display = 'none';
                if (block.querySelector('.gross-income')) block.querySelector('.gross-income').value = '';
                
                handleIncomeTypeChange(typeSelect); 
                
                const firstMonthlyInput = block.querySelector('.monthly-income-row input');
                if(firstMonthlyInput) updateMonthlyTotal(firstMonthlyInput);
            } else {
                monthlyContainer.style.display = 'none';
                grossIncomeContainer.style.display = 'block';
                
                const januaryInput = block.querySelector('.monthly-income-row input[data-month="Jan"]');
                if (januaryInput && januaryInput.autoFillHandler) {
                    januaryInput.removeEventListener('input', januaryInput.autoFillHandler);
                    januaryInput.autoFillHandler = null;
                }

                block.querySelectorAll('.monthly-income-row input').forEach(input => {
                    input.value = '';
                    input.dataset.manual = 'false';
                });
                const monthlyTotal = block.querySelector('.monthly-total');
                if(monthlyTotal) monthlyTotal.textContent = 'Total Annual Income: ₦0';
            }
        }

        function toggleWhtField(selectElement) {
            const type = selectElement.value;
            const block = selectElement.closest('.income-source-block');
            const whtRow = block.querySelector('.wht-row');
            const whtInput = block.querySelector('.wht-input');

            if (whtRow && whtInput) {
                if (['rental', 'investment', 'other'].includes(type)) {
                    whtRow.style.display = 'flex';
                    const tooltipText = block.querySelector('.wht-row .tooltiptext');
                    
                    if (type === 'rental' || type === 'investment') {
                        tooltipText.textContent = 'Enter the amount of 10% WHT deducted by payer, if known. Defaults to 10% of gross income if blank.';
                    } else if (type === 'other') {
                        tooltipText.textContent = 'Enter the amount of 5% WHT deducted by payer, if known. Defaults to 5% of gross income if blank.';
                    }
                } else {
                    whtRow.style.display = 'none';
                    whtInput.value = '';
                }
            }
        }

        function addIncomeSource() {
            const template = document.getElementById('income-template');
            const container = document.getElementById('income-sources-container');
            const newIndex = container.children.length;

            const clone = document.importNode(template.content, true);
            const block = clone.querySelector('.income-source-block');

            block.setAttribute('data-source-id', newIndex);
            block.querySelector('.income-index').textContent = newIndex + 1;
            
            let htmlContent = block.innerHTML;
            htmlContent = htmlContent.replace(/_INDEX/g, `_${newIndex}`);
            block.innerHTML = htmlContent;

            container.appendChild(clone);
            const newBlock = container.lastElementChild;

            const grossIncomeInput = newBlock.querySelector(`#income_${newIndex}`);
            const monthlyInputs = newBlock.querySelectorAll('.monthly-income-container input[type="text"]');
            const whtInput = newBlock.querySelector(`#wht_${newIndex}`);
            const typeSelect = newBlock.querySelector(`#type_${newIndex}`);
            const frequencySelect = newBlock.querySelector(`#freq_${newIndex}`);

            if (grossIncomeInput) {
                grossIncomeInput.addEventListener('input', () => updateFormattedValue(grossIncomeInput));
            }
            if (whtInput) {
                whtInput.addEventListener('input', () => updateFormattedValue(whtInput));
            }
            
            monthlyInputs.forEach(input => {
                input.addEventListener('input', () => updateFormattedValue(input));
                input.addEventListener('input', () => updateMonthlyTotal(input));
                input.addEventListener('input', () => markManualEdit(input));
            });

            typeSelect.addEventListener('change', () => handleIncomeTypeChange(typeSelect));
            frequencySelect.addEventListener('change', () => toggleMonthlyInputs(frequencySelect));
            
            const grossTooltip = newBlock.querySelector('.gross-income-container .tooltip .tooltiptext');
            if (grossIncomeInput) {
                grossIncomeInput.addEventListener('focus', () => showTooltip(grossTooltip, "Total income earned in the year before taxes and deductions."));
                grossIncomeInput.addEventListener('blur', () => hideTooltip(grossTooltip));
            }

            const whtTooltip = newBlock.querySelector('.wht-row .tooltip .tooltiptext');
            if (whtInput) {
                whtInput.addEventListener('focus', () => showTooltip(whtTooltip)); 
                whtInput.addEventListener('blur', () => hideTooltip(whtTooltip));
            }

            newBlock.querySelector('.remove-btn').addEventListener('click', (e) => {
                e.preventDefault();
                removeIncomeSource(e.currentTarget);
            });

            const allBlocks = document.querySelectorAll('.income-source-block');
            allBlocks.forEach(b => {
                b.querySelector('.remove-btn').style.display = allBlocks.length > 1 ? 'flex' : 'none';
            });

            toggleWhtField(typeSelect);
            toggleMonthlyInputs(frequencySelect);
        }

        function removeIncomeSource(button) {
            const blockToRemove = button.closest('.income-source-block');
            blockToRemove.remove();

            const container = document.getElementById('income-sources-container');
            const remainingBlocks = container.querySelectorAll('.income-source-block');
            
            remainingBlocks.forEach((block, index) => {
                block.setAttribute('data-source-id', index);
                block.querySelector('.income-index').textContent = index + 1;
                
                const oldIndexRegex = /_\d+/;
                
                block.querySelectorAll('[id*="_"], [for*="_"]').forEach(el => {
                    const attrName = el.hasAttribute('id') ? 'id' : 'for';
                    let value = el.getAttribute(attrName);
                    
                    const match = value.match(oldIndexRegex);
                    if (match) {
                        value = value.replace(match[0], `_${index}`);
                        el.setAttribute(attrName, value);
                    }
                });
                const typeSelect = block.querySelector('.income-type');
                if (typeSelect) handleIncomeTypeChange(typeSelect);

            });

            if (remainingBlocks.length === 1) {
                remainingBlocks[0].querySelector('.remove-btn').style.display = 'none';
            }
        }

        function validateForm() {
            const outputDiv = document.getElementById('output');
            const msgDiv = document.getElementById('msg');
            const taxSummary = document.getElementById('taxSummary');
            const defaultMessage = document.getElementById('default-report-message');
            msgDiv.textContent = '';
            taxSummary.innerHTML = ''; // Clear previous summary
            defaultMessage.style.display = 'none'; // Hide placeholder during validation
            outputDiv.style.display = 'none'; // Hide output by default

            const incomeBlocks = document.querySelectorAll('.income-source-block');
            if (incomeBlocks.length === 0) {
                msgDiv.textContent = 'Please add at least one income source.';
                outputDiv.style.display = 'block';
                return false;
            }

            let validationPassed = true;
            let totalGrossIncomeCheck = 0;

            for (const block of incomeBlocks) {
                const frequency = block.querySelector('.income-frequency').value;
                const blockIndex = block.getAttribute('data-source-id');
                let incomeInputs = [];

                if (frequency === 'monthly') {
                    incomeInputs = block.querySelectorAll('.monthly-income-container input[type="text"]');
                } else {
                    incomeInputs = [block.querySelector(`#income_${blockIndex}`)];
                }
                
                incomeInputs.forEach(input => {
                    const rawValue = getRawValue(input);
                    if (rawValue < 0) {
                        msgDiv.textContent = 'Income amounts cannot be negative. Please check your inputs.';
                        validationPassed = false;
                    }
                    totalGrossIncomeCheck += rawValue;
                });
                
                const whtRow = block.querySelector('.wht-row');
                if (whtRow && whtRow.style.display !== 'none') {
                    const whtInput = block.querySelector(`#wht_${blockIndex}`);
                    const whtValue = getRawValue(whtInput);
                    if (whtValue < 0) {
                        msgDiv.textContent = 'WHT paid cannot be negative. Please correct the amount.';
                        validationPassed = false;
                    }
                }
            }

            const pension = getRawValue(document.getElementById('pension'));
            const rent = getRawValue(document.getElementById('rent'));
            
            if (pension < 0 || rent < 0) {
                msgDiv.textContent = 'Deduction amounts (Pension/Rent) cannot be negative.';
                validationPassed = false;
            }
            
            if (totalGrossIncomeCheck <= 0) {
                msgDiv.textContent = 'Total annual income must be greater than zero to calculate.';
                validationPassed = false;
            }
            
            if (!validationPassed) {
                outputDiv.style.display = 'block';
                defaultMessage.style.display = 'block'; // Show placeholder with error
                return false;
            }
            
            return true;
        }

        function calculateTax() {
            const state = document.getElementById('state').value;
            const outputDiv = document.getElementById('output');
            const msgDiv = document.getElementById('msg');
            const taxSummary = document.getElementById('taxSummary');
            const defaultMessage = document.getElementById('default-report-message');
            const reportSection = document.getElementById('report');

            // Reset output display and message on new calculation attempt
            msgDiv.textContent = '';
            taxSummary.innerHTML = ''; // Clear previous summary
            defaultMessage.style.display = 'none'; // Hide placeholder initially
            outputDiv.style.display = 'none'; // Hide output by default

            if (!state) {
                msgDiv.textContent = '🛑 Please select your State of Residence to proceed with the tax calculation.';
                outputDiv.style.display = 'block';
                defaultMessage.style.display = 'block'; // Show placeholder below error
                reportSection.scrollIntoView({ behavior: 'smooth' });
                return;
            }

            if (!validateForm()) {
                reportSection.scrollIntoView({ behavior: 'smooth' });
                return;
            }

            // Successful validation: hide placeholder and show output
            defaultMessage.style.display = 'none';
            outputDiv.style.display = 'block';

            console.log("Almost done with the application! Remember these next steps to complete the TaxC application:\n- Input Validation: Ensuring all mandatory fields are filled and values are numerical before calculating.\n- Report Generation Logic: Refining the startHostedPayment flow and user messaging.\n- Responsive Design Refinements: Making final tweaks to how the layout handles different screen sizes.");

            // --- Core Calculation Logic ---
            let totalGrossIncome = 0;
            let totalWhtCredit = 0;
            let hasSalaryOrSelfEmployment = false;

            const incomeBlocks = document.querySelectorAll('.income-source-block');
            for (const block of incomeBlocks) {
                const blockIndex = block.getAttribute('data-source-id');
                const type = document.getElementById(`type_${blockIndex}`).value;
                const frequency = document.getElementById(`freq_${blockIndex}`).value;
                let incomeValue = 0;

                if (frequency === 'monthly') {
                    const monthlyInputs = block.querySelectorAll('.monthly-income-row input');
                    monthlyInputs.forEach(input => {
                        incomeValue += getRawValue(input);
                    });
                } else {
                    const incomeInput = document.getElementById(`income_${blockIndex}`);
                    incomeValue = getRawValue(incomeInput);
                }
                totalGrossIncome += incomeValue;

                if (type === 'salary' || type === 'self') {
                    hasSalaryOrSelfEmployment = true;
                }
                
                if (['rental', 'investment', 'other'].includes(type)) {
                    const whtInput = document.getElementById(`wht_${blockIndex}`);
                    const whtValue = getRawValue(whtInput);
                    
                    let defaultWhtRate = 0;
                    if (type === 'rental' || type === 'investment') {
                        defaultWhtRate = 0.10; 
                    } else if (type === 'other') {
                        defaultWhtRate = 0.05; 
                    }

                    const whtAmount = whtValue > 0 ? whtValue : (incomeValue * defaultWhtRate);
                    totalWhtCredit += whtAmount;
                }
            }

            const pension = getRawValue(document.getElementById('pension'));
            const rent = getRawValue(document.getElementById('rent'));
            
            // Rent relief calculation
            const rentRelief = hasSalaryOrSelfEmployment ? Math.min(500000, rent * 0.20) : 0; 
            
            const totalDeductions = pension + rentRelief; 
            const incomeBeforeExemption = Math.max(0, totalGrossIncome - totalDeductions); 
            const chargeable = Math.max(0, incomeBeforeExemption - 800000); 

            let tax = 0;
            let remaining = chargeable;
            
            const bands = [
                { limit: 2200000, rate: 0.15 },
                { limit: 9000000, rate: 0.18 },
                { limit: 13000000, rate: 0.21 },
                { limit: 25000000, rate: 0.23 },
                { limit: Infinity, rate: 0.25 }
            ];
            
            for (const band of bands) {
                if (remaining <= 0) break;
                const taxableInBand = Math.min(remaining, band.limit);
                tax += taxableInBand * band.rate;
                remaining -= taxableInBand;
            }

            const netTax = Math.max(0, tax - totalWhtCredit);
            const monthlyTax = (netTax / 12);
            
            let stateNote = '';
            if (rentRelief > 0) {
                stateNote = `<br><strong>Note:</strong> Your rent relief was calculated as 20% of ₦${rent.toLocaleString('en-NG')}, capped at ₦${Math.round(rentRelief).toLocaleString('en-NG')}.`;
            }
            
            // --- Output Display ---
            taxSummary.innerHTML = `
            <strong>Annual Tax Estimate:</strong> ₦${Math.round(netTax).toLocaleString('en-NG')}<br>
            <strong>Monthly (approx):</strong> ₦${Math.round(monthlyTax).toLocaleString('en-NG')}<br><br>
            <strong>Gross Income:</strong> ₦${totalGrossIncome.toLocaleString('en-NG')}<br>
            <strong>Total Allowable Deductions:</strong> ₦${Math.round(totalDeductions).toLocaleString('en-NG')} (Pension + Rent Relief)<br>
            <strong>Income Before Exemption:</strong> ₦${Math.round(incomeBeforeExemption).toLocaleString('en-NG')}<br>
            <strong>Chargeable Income:</strong> ₦${Math.round(chargeable).toLocaleString('en-NG')} (After ₦800,000 exemption)<br>
            ${totalWhtCredit > 0 ? `<strong>WHT Credit Applied:</strong> ₦${Math.round(totalWhtCredit).toLocaleString('en-NG')}` : ''}
            ${stateNote}
            `;
            
            msgDiv.textContent = 'Calculation complete. Enter your email and pay ₦500 for a detailed PDF report.';
            outputDiv.style.display = 'block';

            // Auto-scroll to Report section
            reportSection.scrollIntoView({ behavior: 'smooth' });
            window.lastCalc = { netTax, state };
        }

        function resetForm() {
            const incomeBlocks = document.querySelectorAll('.income-source-block');
            const outputDiv = document.getElementById('output');
            const msgDiv = document.getElementById('msg');
            const taxSummary = document.getElementById('taxSummary');
            const defaultMessage = document.getElementById('default-report-message');
            const stateSelect = document.getElementById('state');

            document.getElementById('pension').value = '';
            document.getElementById('rent').value = '';
            document.getElementById('reportEmail').value = '';
            
            if (stateSelect) {
                stateSelect.value = ''; 
            }
            
            // Remove all existing income blocks
            incomeBlocks.forEach(block => block.remove());

            // Add back the default first income source
            addIncomeSource();

            // Reset output section
            outputDiv.style.display = 'block';
            msgDiv.textContent = '';
            taxSummary.innerHTML = '';
            defaultMessage.style.display = 'block'; // Show placeholder on reset
            window.lastCalc = null;
        }

        function startHostedPayment() {
            const email = document.getElementById('reportEmail')?.value || '';
            
            if (!email || !/^\S+@\S+\.\S+$/.test(email)) {
                document.getElementById('msg').textContent = 'Please enter a valid email to receive the report.';
                return;
            }
            if (!window.lastCalc) {
                document.getElementById('msg').textContent = 'Please calculate your tax first.';
                return;
            }
            
            // Reminder for the Report Generation Logic task
            const nextSteps = 'You are almost done with the application! Remember these next steps to complete the TaxC application:\n- Report Generation Logic: Refining the startHostedPayment flow and user messaging.';
            console.log(nextSteps); 
            
            document.getElementById('msg').textContent = 'Redirecting to payment... (Placeholder). Check console for development reminder.';
            alert("Payment initiated! " + nextSteps); 
            
            const paystackHostedLink = "https://paystack.com/pay/TAX-C-REPORT-500-NGN"; 
            
            // window.location.href = paystackHostedLink;
        }

        document.addEventListener('DOMContentLoaded', () => {
            addIncomeSource();

            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', scrollToSection);
            });
            
            const pensionInput = document.getElementById('pension');
            const rentInput = document.getElementById('rent');
            if (pensionInput) pensionInput.addEventListener('input', () => updateFormattedValue(pensionInput));
            if (rentInput) rentInput.addEventListener('input', () => updateFormattedValue(rentInput));
        });
    </script>
</body>
</html>