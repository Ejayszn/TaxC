<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaxC - Nigerian Tax Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
    <link rel="icon" href="./favicon.ico">
    <link rel="manifest" href="./site.webmanifest">

    <link rel="stylesheet" href="styles/animations.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Paystack Inline (Test + Live auto-switch) -->
<script src="https://js.paystack.co/v2/inline.js"></script>
    
    <style>

    .chat-clear {
  position: absolute;
  right: 44px; /* Moves it left of the X */
  top: 50%;
  transform: translateY(-50%);
  background: #dc3545; /* Red */
  color: #fff;
  border: none;
  font-size: 0.75rem; /* Smaller text */
  padding: 4px 8px; /* Smaller button */
  border-radius: 4px;
  cursor: pointer;
  opacity: 0.9;
}
.chat-clear:hover {
  opacity: 1;
  background: #c82333;
}

/* MOBILE FIX: Move Clear further left + smaller */
@media (max-width: 480px) {
  .chat-clear {
    right: 35px; /* Closer to center on mobile */
    font-size: 0.7rem; /* Even smaller text */
    padding: 2px 6px; /* Tighter padding */
  }
  .chat-header {
    padding: 10px 8px; /* Less padding on mobile */
    font-size: 0.9rem; /* Smaller title text */
  }
  .chat-close {
    right: 5px; /* X closer to edge */
    font-size: 1.2rem; /* Slightly smaller X */
  }
}
    
/* -------------------- Color Palette: Vibrant Primary Green #28A745 -------------------- */
:root {
    /* Mapped main app colors to colors for easier maintenance */
    --green: #28A745; 
    --dark-green: #218838;
    --soft: #F8F9FA; /* Light background */
    --muted: #6c757d;
    --card: #ffffff;
    --main-color: #28A745;
    --dark-text: #343A40;
}
/* -------------------- Global Reset & Typography -------------------- */
body {
    font-family: 'Inter', sans-serif;
    background-color: #F8F9FA;
    color: #343A40;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    scroll-behavior: smooth;
}
.container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 20px;
}
h2.section-title {
    font-size: 2rem;
    color: #28A745; /* Primary Green */
    margin-bottom: 30px;
    text-align: center;
    font-weight: 700;
}
/* -------------------- Hero Section Styles -------------------- */
.hero-section {
    padding: 40px 20px; 
    text-align: center;
    background-color: #FFFFFF;
    border-bottom: 5px solid #28A745;
    margin-bottom: 40px;
    border-radius: 10px;
}
.hero-section h1 {
    font-size: 3rem;
    /* FIX HERE: Changed color from #343A40 (dark text) to #28A745 (Primary Green) */
    color: #28A745; 
    margin-bottom: 10px; 
    font-weight: 700;
}
.hero-section p {
    font-size: 1.25rem;
    color: #555;
    max-width: 800px;
    margin: 0 auto 20px; 
}

.cta-button {
    display: inline-block;
    padding: 12px 25px;
    background-color: #28A745; /* Primary Green */
    color: white;
    text-decoration: none;
    border-radius: 50px;
    font-weight: 600;
    transition: background-color 0.3s, transform 0.2s;
}
.cta-button:hover {
    background-color: #218838; /* Darker Green (Hover) */
    transform: translateY(-2px);
}

.cta-small { 
    background: var(--green); 
    color: #fff; 
    padding: 8px 14px; 
    border-radius: 6px; 
    border: none; 
    cursor: pointer; 
    font-weight: 600;
} 
.cta-small:hover { 
    background: var(--dark-green); 
}
/* ==================== DROPDOWN MENU STYLES ==================== */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            text-decoration: none;
            color: #343A40;
            padding: 8px 15px;
            transition: color 0.3s;
            font-weight: 600;
        }
        .desktop-nav .dropdown-toggle:hover,
        .mobile-menu .dropdown-toggle:hover {
            color: #28A745;
        }
        .dropdown-arrow {
            font-size: 0.8em;
            transition: transform 0.3s ease;
            display: inline-block;
        }
        .dropdown[open] .dropdown-arrow {
            transform: rotate(180deg);
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #fff;
            min-width: 280px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            padding: 15px;
            z-index: 1000;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 1px solid #eee;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        .dropdown[open] .dropdown-content {
            display: block;
        }
        .dropdown-content ul {
            margin: 0;
            padding-left: 18px;
            color: #444;
        }
        .dropdown-content strong {
            color: #444;
        }

        /* Mobile dropdown adjustment */
        .mobile-menu .dropdown {
            width: 100%;
        }
        .mobile-menu .dropdown-toggle {
            justify-content: space-between;
            padding: 12px 20px;
            border-bottom: 1px solid #eee;
        }
        .mobile-menu .dropdown-content {
            position: static;
            box-shadow: none;
            border: none;
            border-top: 1px solid #eee;
            border-radius: 0;
            padding: 15px 20px;
            background-color: #f9f9f9;
            transform: none;
            left: auto;
        }

        /* Prevent body scroll when mobile menu open */
        body.menu-open {
            overflow: hidden;
        }

/* -------------------- Header & Navigation (HEIGHT REDUCED) -------------------- */
.main-header {
    background-color: #ffffff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    padding: 5px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
}
.logo {
    font-size: 1.8rem;
    font-weight: 700;
    color: #28A745; /* Primary Green */
    text-decoration: none;
    display: flex;
    align-items: center; 
    gap: 8px;
}
.logo-icon {
    height: 24px;
    width: 24px;
}
.desktop-nav a, .mobile-menu a {
    text-decoration: none;
    color: #343A40;
    padding: 8px 15px;
    transition: color 0.3s;
    font-weight: 600;
}
.desktop-nav a:hover, .mobile-menu a:hover {
    color: #28A745; /* Primary Green */
}
.desktop-nav {
    display: none; 
}

/* Hamburger Styles (Fixed) */
#hamburger {
    background: none;
    border: none;
    cursor: pointer;
    display: block; 
    padding: 0;
    width: 30px;
    height: 20px;
    position: relative;
    top: 0;
}
.hamburger-box {
    width: 100%;
    height: 100%;
    display: block;
    position: relative;
}
.hamburger-inner, .hamburger-inner::before, .hamburger-inner::after {
    position: absolute;
    height: 2px;
    width: 100%;
    background-color: #343A40;
    transition: transform 0.3s ease, opacity 0.3s ease;
    left: 0;
}
.hamburger-inner {
    top: 50%;
    transform: translateY(-50%);
}
.hamburger-inner::before { 
    content: '';
    top: -8px;
}
.hamburger-inner::after { 
    content: '';
    bottom: -8px;
}

/* Active state for animation */
.hamburger.is-active .hamburger-inner { 
    transform: translateY(-50%) rotate(45deg); 
}
.hamburger.is-active .hamburger-inner::before { 
    opacity: 0;
}
.hamburger.is-active .hamburger-inner::after { 
    transform: translateY(0) rotate(-90deg);
    top: 0;
}

.mobile-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: #fff;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 10px 0;
    flex-direction: column;
    z-index: 99;
}
.mobile-menu[open] {
    display: flex;
}
.mobile-menu a {
    padding: 10px 20px;
    border-bottom: 1px solid #eee;
}

/* -------------------- General Card & Form Styles -------------------- */
.content-section {
    padding: 40px 0;
}
.card-form, .card-output {
    background-color: #FFFFFF;
    padding: 30px; 
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    margin-bottom: 30px;
}

/* PERFECT SECTION DIVIDER â€” works on mobile & desktop, never overlaps */
.section-divider {
    position: relative;
    text-align: center;
    margin: 40px 0 25px;
    font-weight: 600;
    color: #28A745;
    line-height: 1.4;
}

.section-divider::before,
.section-divider::after {
    content: '';
    position: absolute;
    top: 50%;
    height: 1px;
    background: #ddd;
    width: 50vw;           /* keep stretching with screen size */
    max-width: none;       /* â† CHANGE THIS LINE (remove the 100px cap) */
    transform: translateY(-50%);
}

.section-divider::before { left: 0; }
.section-divider::after  { right: 0; }

.section-divider span {
    background: #fff;
    padding: 0 20px;
    position: relative;
    z-index: 1;
}
/* Card Content Spacing & Centering */
.card-form .container-content { 
    max-width: 800px;
    margin: 0 auto;
    padding: 0 20px;
}
/* CRITICAL FIX: Ensure all fields are flush left */
.card-form .input-row,
.card-form .input-group,
.card-form .add-income-btn,
.card-form .calculate-btn,
.card-form .income-sources-list,
.card-form .section-divider {
    margin-left: 0; 
    margin-right: 0;
    max-width: 100%; 
}

/* -------------------- Input Groups -------------------- */
.input-group, .input-row {
    margin-bottom: 20px;
}
.input-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #555;
}
input[type="text"], input[type="email"], select {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    box-sizing: border-box;
    font-size: 1rem;
    transition: border-color 0.3s;
}
input:focus, select:focus {
    border-color: #28A745; /* Primary Green */
    outline: none;
    box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.25); /* Primary Green (with transparency) */
}

/* -------------------- Buttons -------------------- */
.calculate-btn {
    display: block;
    width: 100%;
    padding: 15px;
    background-color: #28A745; /* Primary Green */
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-top: 30px;
}
.calculate-btn:hover {
    background-color: #218838; /* Darker Green (Hover) */
}
.add-income-btn {
    background: none;
    border: 1px dashed #28A745; /* Primary Green */
    color: #28A745; /* Primary Green */
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    margin-top: 10px;
    transition: background-color 0.3s, color 0.3s;
}
.add-income-btn:hover {
    background-color: #e6ffe6; /* Light green hover */
}
/* Reset Button Default (Black) */
.reset-btn {
    display: block;
    width: 100%;
    padding: 15px;
    background-color: #e5e5e5;
    color: rgb(0, 0, 0);             
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-top: 10px; /* Space it 10px below the Calculate button */
}

/* Reset Button Hover (Brighter Shade of Black / Dark Gray) */
.reset-btn:hover {
    background-color: #a4a4a4; /* Darker Grey for Hover */
}

/* -------------------- How It Works Section -------------------- */
.steps-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 20px;
}
.step-card {
    background: #FFFFFF;
    padding: 25px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    border-top: 5px solid #28A745; /* Primary Green */
}
.step-number {
    display: inline-block;
    width: 40px;
    height: 40px;
    line-height: 40px;
    border-radius: 50%;
    background-color: #28A745; /* Primary Green */
    color: white;
    font-weight: 700;
    margin-bottom: 10px;
}
.step-card h3 {
    color: #343A40;
    margin-top: 0;
}

/* -------------------- Income Source Block (Template Styling) -------------------- */
.income-source-block {
    border: 1px solid #ddd;
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 8px;
    position: relative;
    background-color: #fefefe;
}
/* Income Source Alignment Fix: Use flexbox and reset margins/paddings */
.income-source-block .input-row {
    display: flex;
    gap: 20px;
    margin-left: 0;
    margin-right: 0;
    padding: 0;
}
.income-source-block .input-row .input-group {
    flex: 1;
    margin-left: 0;
    margin-right: 0;
    padding: 0;
}
.gross-income-container {
    margin-left: 0; 
    margin-right: 0;
    padding: 0;
}
.income-source-block > * {
    margin-left: 0;
    margin-right: 0;
    padding-left: 0;
    padding-right: 0;
}
.income-source-block .income-header {
    margin-bottom: 15px;
    padding-bottom: 10px;
    margin-left: initial;
    margin-right: initial;
}
.income-source-block .remove-btn {
    padding-right: 0;
}
/* End of Income Source Alignment Fix */

.income-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}
.income-header h3 {
    margin: 0;
    font-size: 1.2rem;
    color: #28A745; /* Primary Green */
}
.income-index {
    display: inline-block;
    background: #28A745; /* Primary Green */
    color: white;
    border-radius: 4px;
    padding: 2px 8px;
    margin-right: 10px;
    font-size: 0.9rem;
}
.remove-btn {
    background: none;
    border: none;
    color: #dc3545;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    transition: color 0.3s;
    padding: 0;
}
.remove-btn:hover {
    color: #a71d2a;
}

/* Redefine grid for general input-rows */
.input-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    align-items: flex-start;
}
/* DEDUCTION FIELDS ALIGNMENT FIX */
.deductions-row { 
    display: flex; 
    gap: 20px;
    margin-left: 0; 
    margin-right: 0;
    margin-bottom: 20px; 
    padding: 0;
}
.deductions-row .input-group {
    flex: 1; 
    margin-bottom: 0;
    padding: 0;
}
.card-form .input-group:last-of-type {
    margin-left: 0;
    margin-right: 0;
}
/* End of Deduction Alignment Fix */

.gross-income-container, .wht-row {
    display: flex; 
    flex-direction: column;
}
/* Monthly Income Table Look (using your .monthly-income-row) */
.monthly-income-container {
    padding: 10px;
    border: 1px solid #eee;
    border-radius: 6px;
    background-color: #fcfcfc;
}
.monthly-income-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 10px;
}
.monthly-income-row label {
    font-size: 0.85rem;
    margin-bottom: 5px;
    text-align: center;
}
.monthly-income-row input {
    text-align: center;
}
.monthly-total {
    text-align: right;
    font-weight: 700;
    color: #28A745; /* Primary Green */
    padding-top: 10px;
    border-top: 1px solid #eee;
    margin-top: 10px;
}
.tooltip {
    position: relative;
    display: inline-block;
    cursor: help;
}
.tooltip .tooltiptext {
    visibility: hidden;
    width: 200px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px;
    position: absolute;
    z-index: 1;
    bottom: 125%; 
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 0.85rem;
}
.tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
}
.clickable-tooltip {
    position: relative;
    display: inline-block;
    width: 100%;
}
.clickable-tooltip .tooltip-popup {
    visibility: hidden;
    opacity: 0;
    width: 240px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 8px;
    position: absolute;
    z-index: 10;
    bottom: 125%;
    left: 50%;
    margin-left: -120px;
    transition: opacity .2s, visibility .2s;
    font-size: .85rem;
    pointer-events: none;
}
.clickable-tooltip.active .tooltip-popup {
    visibility: visible;
    opacity: 1;
}

/* -------------------- Output & Report Section -------------------- */
.message-area {
    padding: 10px;
    background-color: #e6ffe6; /* Light green for info/success messages */
    color: #218838; /* Darker green text */
    border: 1px solid #28A745; /* Primary Green border */
    border-radius: 5px;
    margin-bottom: 20px;
    font-weight: 600;
    text-align: center;
}
.tax-summary-box {
    background-color: #e9ecef; /* Light grey box for summary */
    padding: 20px;
    border-radius: 6px;
    font-size: 1.1rem;
    line-height: 1.8;
}
.tax-summary-box strong {
    color: #28A745; /* Primary Green */
}
.report-section {
    margin-top: 25px;
    padding-top: 15px;
    border-top: 1px dashed #ddd;
}
.report-prompt {
    font-style: italic;
    color: #6c757d;
}
.input-group-inline {
    display: flex;
    gap: 10px;
}
.input-group-inline input[type="email"] {
    flex-grow: 1;
}
.report-btn {
    background-color: #28A745; /* Primary Green */
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    white-space: nowrap;
    transition: background-color 0.3s;
}
.report-btn:hover {
    background-color: #218838; /* Darker green on hover */
}

/* -------------------- Media Queries (Responsiveness) -------------------- */
@media (min-width: 768px) {
    .desktop-nav {
        display: flex;
    }
    #hamburger {
        display: none;
    }
    .content-section {
        padding: 50px 0;
    }
    /* Adjust card padding for larger screens */
    .card-form, .card-output {
        padding: 40px;
    }
    /* Ensure deduction fields are still side-by-side on desktop */
    .deductions-row {
        flex-direction: row; 
    }
}

@media (max-width: 576px) {
    .monthly-income-row {
        grid-template-columns: repeat(2, 1fr); 
    }
    .input-group-inline {
        flex-direction: column;
    }
    /* Income Source block fixes (stacking) */
    .income-source-block .input-row {
        flex-direction: column;
        gap: 0;
    }
    .income-source-block .input-row .input-group {
        margin-bottom: 20px;
    }
    /* Deduction fields must also stack on mobile */
    .deductions-row {
        flex-direction: column;
        gap: 0;
        margin-bottom: 0; 
    }
    .deductions-row .input-group {
        margin-bottom: 20px;
    }
    
    .card-form, .card-output {
        padding: 20px;
    }
    .card-form .container-content {
        padding: 0 10px;
    }
}
/* Your existing styles remain â€” we ADD the chatbot */
    body { font-family: 'Inter', sans-serif; position: relative; }

   /* === FLOATING CHAT (MESSAGE ICON + TOOLTIP) === */
#taxc-chat-widget {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 10000;
}

/* â€”â€”â€” ANIMATED FLOATING AI ICON (Makes users KNOW they can click it!) â€”â€”â€” */
.chat-launcher {
  position: relative;
  width: 60px;
  height: 60px;
  background: #28A745;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 20px rgba(40, 167, 69, 0.4);
  transition: all 0.3s ease;
  animation: float 6s ease-in-out infinite, pulseGlow 2s ease-in-out infinite alternate;
  z-index: 10001;
}

/* Gentle floating up & down */
@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-12px); }
}

/* Subtle glowing pulse */
@keyframes pulseGlow {
  from { box-shadow: 0 4px 20px rgba(40, 167, 69, 0.4); }
  to { box-shadow: 0 8px 30px rgba(40, 167, 69, 0.7); }
}

/* Hover = bigger jump + brighter glow */
.chat-launcher:hover {
  transform: translateY(-16px) scale(1.1) !important;
  box-shadow: 0 12px 40px rgba(40, 167, 69, 0.8);
  background: #218838;
}

/* Optional: tiny bounce when page loads */
@keyframes bounceIn {
  0% { transform: scale(0.3); opacity: 0; }
  50% { transform: scale(1.1); }
  70% { transform: scale(0.95); }
  100% { transform: scale(1); opacity: 1; }
}

.chat-launcher {
  animation: bounceIn 1s ease-out, float 6s ease-in-out infinite 1s, pulseGlow 2s ease-in-out infinite alternate;
}

/* Mobile: slightly smaller but still animated */
@media (max-width: 480px) {
  .chat-launcher {
    width: 55px;
    height: 55px;
  }
  .chat-launcher svg { width: 24px; height: 24px; }
  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }
}

.chat-tooltip {
  position: absolute;
  right: 70px;
  top: 50%;
  transform: translateY(-50%);
  background: #333;
  color: white;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 0.85rem;
  font-weight: 600;
  white-space: nowrap;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  pointer-events: none;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.chat-tooltip::after {
  content: '';
  position: absolute;
  left: 100%;
  top: 50%;
  transform: translateY(-50%);
  border: 6px solid transparent;
  border-left-color: #333;
}

.chat-launcher:hover .chat-tooltip {
  opacity: 1;
  visibility: visible;
  right: 68px;
}

.chat-window {
  display: none;
  width: 340px;
  height: 520px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
  flex-direction: column;
  overflow: hidden;
  border: 1px solid #eee;
}

.chat-header {
  background: #28A745;
  color: white;
  padding: 14px;
  font-weight: 700;
  text-align: center;
  position: relative;
}

.chat-header::before {
  content: "";
  display: inline-block;
  width: 8px;
  height: 8px;
  background: #fff;
  border-radius: 50%;
  margin-right: 8px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.chat-close {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: white;
  font-size: 1.4rem;
  cursor: pointer;
}

.chat-body {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
  background: #f8f9fa;
}

.message {
  margin: 10px 0;
  padding: 10px 14px;
  border-radius: 18px;
  max-width: 80%;
  line-height: 1.5;
  font-size: 0.95rem;
}

.user {
  background: #28A745;
  color: white;
  margin-left: auto;
  border-bottom-right-radius: 4px;
}

.ai {
  background: white;
  color: #333;
  border: 1px solid #eee;
  margin-right: auto;
  border-bottom-left-radius: 4px;
}

.chat-input {
  display: flex;
  padding: 10px;
  border-top: 1px solid #eee;
  background: white;
}

.chat-input input {
  flex: 1;
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 25px;
  font-size: 0.95rem;
}

.chat-input button {
  margin-left: 8px;
  background: #28A745;
  color: white;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
}

/* Mobile */
@media (max-width: 480px) {
  .chat-window { width: 300px; height: 480px; }
  .chat-launcher { width: 55px; height: 55px; }
  .chat-launcher svg { width: 24px; height: 24px; }
  .chat-tooltip { display: none; }
}

/* Add inside <style> block */
.report-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

/* â€”â€”â€” LOGO + GREETING PERFECT ALIGNMENT (copy to all pages) â€”â€”â€” */
.logo-container {
  display: flex;
  align-items: center;
  gap: 12px;
  height: 40px;                  /* locks the height so everything aligns */
}

.logo-container .logo-icon {
  height: 28px;
  width: auto;
  vertical-align: middle;
  margin-bottom: -2px;           /* tiny nudge for favicons with whitespace */
}

#userDisplay {
  display: none;                 /* hidden when not logged in */
  color: #28A745;
  font-weight: 600;
  font-size: 1.1rem;
  line-height: 1;
  margin: 0;
  white-space: nowrap;
}

/* Optional: slightly smaller greeting on very small phones */
@media (max-width: 480px) {
  #userDisplay {
    font-size: 1rem;
  }
}

footer {
            margin-top: 24px; padding: 20px; text-align: center; color: var(--muted);
            border-top: 1px solid #eee;
        }


</style>
</head>
<body>

    <audio id="ada-message-sound" preload="auto">
  <source src="taxcaiadamessage.mp3" type="audio/mpeg">
</audio>

    <header class="main-header">
    <div class="logo-container">
  <a class="logo" href="index.html">
    <img src="./favicon.ico" alt="TaxC Logo" class="logo-icon">
    TaxC
  </a>
  <span id="userDisplay" style="display:none; color:#28A745; font-weight:600; margin-left:15px; font-size:1rem;"></span>
</div>
        
        <!-- DESKTOP NAV -->
        <nav class="desktop-nav">
            <div class="dropdown" id="desktop-dropdown">
                <span class="dropdown-toggle" onclick="toggleDropdown(event, 'desktop-dropdown')">
                    Detailed Report content
                    <span class="dropdown-arrow">â–¼</span>
                </span>
                <div class="dropdown-content">
                    <ul>
                        <li><strong>Your tax summary explained clearly</strong></li>
                        <li>All your income sources listed</li>
                        <li>Step-by-step: How your tax was calculated (we do the math!)</li>
                        <li>How much tax you <em>really</em> owe</li>
                        <li>Monthly breakdown (so you can plan)</li>
                        <li>Any tax already paid</li>
                        <li><strong>Direct link to pay your state IRS</strong></li>
                        <li>How & when to file your tax</li>
                        <li>Print-ready PDF, keep it forever</li>
                    </ul>
                </div>
            </div>
            <a href="faq.html">FAQ</a>
            <a href="ebooks.html">Ebooks</a>
            <a href="#calculator">Calculator</a>
            <button class="cta-small" id="auth-button"></button>
        </nav>

        <button id="hamburger" class="hamburger" onclick="toggleMobileMenu()" type="button">
            <span class="hamburger-box"><span class="hamburger-inner"></span></span>
        </button>

        <!-- MOBILE MENU -->
        <nav id="menu" class="mobile-menu nav-dropdown-menu">
            <div class="dropdown" id="mobile-dropdown">
                <span class="dropdown-toggle" onclick="toggleDropdown(event, 'mobile-dropdown')">
                    Detailed Report content
                    <span class="dropdown-arrow">â–¼</span>
                </span>
                <div class="dropdown-content">
                    <ul>
                        <li><strong>Your tax summary explained clearly</strong></li>
                        <li>All your income sources listed</li>
                        <li>Step-by-step: How your tax was calculated (we do the math!)</li>
                        <li>How much tax you <em>really</em> owe</li>
                        <li>Monthly breakdown (so you can plan)</li>
                        <li>Any tax already paid</li>
                        <li><strong>Direct link to pay your state IRS</strong></li>
                        <li>How & when to file your tax</li>
                        <li>Print-ready PDF, keep it forever</li>
                    </ul>
                </div>
            </div>
            <a href="faq.html">Frequently Asked Questions</a>
            <a href="ebooks.html">Ebooks</a>
            <a href="#calculator" class="nav-link">Calculator</a>
            <button class="cta-small" id="auth-button-mobile"></button>
        </nav>
    </header>
    <main class="container">
        
        <section class="hero-section fade-in">
            <h1>Nigerian Tax Calculator (P.I.T)</h1>
            <p>Use this calculator to accurately find out how much Personal Income Tax (P.I.T.) you should pay. It uses the latest tax rules (NTA 2025 reform) and includes all your deductions, like for your pension, rent, etc.</p>
            <a href="#calculator" class="cta-button">Start Calculation Now</a>
        </section>

        <section id="how-it-works" class="content-section fade-in">
            <h2 class="section-title">ðŸ’¡ How Our Tax Calculator Works</h2>
            <div class="steps-container">
                <div class="step-card fade-in">
                    <span class="step-number">1</span>
                    <h3>Input Income</h3>
                    <p>Enter all income sources (Salary, Rental, Self-Employed, etc.) and choose annual or monthly frequency.</p>
                </div>
                <div class="step-card fade-in">
                    <span class="step-number">2</span>
                    <h3>Apply Deductions</h3>
                    <p>Enter your Pension contributions, Annual Rent, etc, to automatically calculate reliefs based on current tax laws.</p>
                </div>
                <div class="step-card fade-in">
                    <span class="step-number">3</span>
                    <h3>Calculate Tax</h3>
                    <p>Click Calculate Tax to instantly see your estimated annual and monthly tax liability based on Nigerian P.I.T. Act.</p>
                </div>
            </div>
        </section>

        <hr>

        <section id="calculator" class="content-section card-form fade-in">
    <div class="container-content">  <h2 class="section-title">Tax Calculator</h2>
        
        <div id="income-sources-container" class="income-sources-list">
            </div>

        <button onclick="addIncomeSource()" class="add-income-btn">âž• Add Another Income Source</button>

        <div class="section-divider">
    <span>Allowable Deductions (2026 Rules)</span>
</div>
<div class="input-row">
    <div class="input-group">
        <label for="pension">Pension Contribution (8%) (â‚¦)</label>
        <input type="text" id="pension" oninput="updateFormattedValue(this)" placeholder="e.g. 600,000...Omit if unapplicable">
    </div>
    <div class="input-group">
        <label for="nhf">NHF Contribution (2.5%) (â‚¦)</label>
        <input type="text" id="nhf" oninput="updateFormattedValue(this)" placeholder="e.g. 187,500...Omit if unapplicable">
    </div>
</div>
<div class="input-row">
    <div class="input-group">
        <label for="nhis">NHIS Contribution (â‚¦)</label>
        <input type="text" id="nhis" oninput="updateFormattedValue(this)" placeholder="e.g. 90,000...Omit if unapplicable">
    </div>
    <div class="input-group">
        <label for="lifeinsurance">Life Insurance Premium (â‚¦)</label>
        <input type="text" id="lifeinsurance" oninput="updateFormattedValue(this)" placeholder="e.g. 120,000...Omit if unapplicable">
    </div>
</div>
<div class="input-row">
    <div class="input-group">
        <label for="mortgage">Mortgage Interest (Owner-Occupier) (â‚¦)</label>
        <input type="text" id="mortgage" oninput="updateFormattedValue(this)" placeholder="e.g. 800,000...Omit if unapplicable">
    </div>
    <div class="input-group">
        <label for="rent">Annual Rent Paid (â‚¦)</label>
        <input type="text" id="rent" oninput="updateFormattedValue(this)" placeholder="e.g. 2,400,000...Omit if unapplicable">
    </div>
</div>
        
        <div class="input-group">
            <label for="state">State of Residence (For P.I.T. purposes)</label>
    <select id="state" name="state" required aria-label="State of Residence">
        <option value="" disabled selected>Select your State...</option>
        <option value="FCT Abuja">FCT Abuja</option>
        <option value="Abia">Abia</option>
        <option value="Adamawa">Adamawa</option>
        <option value="Akwa Ibom">Akwa Ibom</option>
        <option value="Anambra">Anambra</option>
        <option value="Bauchi">Bauchi</option>
        <option value="Bayelsa">Bayelsa</option>
        <option value="Benue">Benue</option>
        <option value="Borno">Borno</option>
        <option value="Cross River">Cross River</option>
        <option value="Delta">Delta</option>
        <option value="Ebonyi">Ebonyi</option>
        <option value="Edo">Edo</option>
        <option value="Ekiti">Ekiti</option>
        <option value="Enugu">Enugu</option>
        <option value="Gombe">Gombe</option>
        <option value="Imo">Imo</option>
        <option value="Jigawa">Jigawa</option>
        <option value="Kaduna">Kaduna</option>
        <option value="Kano">Kano</option>
        <option value="Katsina">Kastina</option>
        <option value="Kebbi">Kebbi</option>
        <option value="Kogi">Kogi</option>
        <option value="Kwara">Kwara</option>
        <option value="Lagos">Lagos</option>
        <option value="Nasarawa">Nasarawa</option>
        <option value="Niger">Niger</option>
        <option value="Ogun">Ogun</option>
        <option value="Ondo">Ondo</option>
        <option value="Osun">Osun</option>
        <option value="Oyo">Oyo</option>
        <option value="Plateau">Plateau</option>
        <option value="Rivers">Rivers</option>
        <option value="Sokoto">Sokoto</option>
        <option value="Taraba">Taraba</option>
        <option value="Yobe">Yobe</option>
        <option value="Zamfara">Zamfara</option>
    </select>
</div>
        
        <button onclick="calculateTax()" class="calculate-btn">Calculate Tax</button>
        <button onclick="resetForm()" class="reset-btn">Reset Calculator</button>
    </div> </section>

        <hr>

        <section id="report" class="content-section card-output fade-in">
    <h2 class="section-title">Tax Summary & Report</h2>
    
    <div id="output" style="display: none;"> 
        <div id="msg" class="message-area"></div> 
        <div id="default-report-message" style="text-align: center; color: #777; padding: 20px 10px; margin: 20px auto; max-width: 600px; border: 1px dashed #ffffff; border-radius: 8px; background-color: #f9f9f9;">
            When you calculate your tax, the detailed summary and breakdown of your estimated annual tax would appear here.
        </div>
        <div id="taxSummary"></div>
        <div class="report-section">
            <p class="report-prompt">
    Get a detailed 
    <a href="#" onclick="scrollToWhyReport(event); return false;" 
       style="color: #28A745; font-weight: 600; text-decoration: underline; cursor: pointer;">
        PDF report
    </a> 
    for only â‚¦500:
</p>
            <div class="input-group-inline">
                <!-- Paystack Inline Script -->

<button id="paystack-btn" class="report-btn">Pay â‚¦500 & Download PDF</button>

<script>
// Paystack Inline â€“ â‚¦500 PDF Report
document.getElementById("paystack-btn").onclick = function() {
  if (!window.lastCalc) {
    alert("Please calculate your tax first");
    return;
  }

  let handler = PaystackPop.setup({
    key: 'pk_test_bc9c09e6d51c4e025bb44c6c57ad1c1144386b55', // your test public key
    email: prompt("Enter your email for receipt & PDF delivery"),
    amount: 50000, // â‚¦500 in kobo
    currency: "NGN",
    ref: 'TAXC_' + Math.floor((Math.random() * 1000000000) + 1),
    onClose: function(){ alert('Payment cancelled'); },
    callback: function(response) {
      fetch('https://us-central1-taxc-ebooks.cloudfunctions.net/verifyPayment', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ reference: response.reference })
      })
      .then(r => r.json())
      .then(data => {
        if (data.status === true) {
          alert("Payment successful! Generating your PDF...");
          generatePDFReport(); // your existing function
        } else {
          alert("Payment failed: " + data.message);
        }
      })
      .catch(() => alert("Verification error â€“ contact support"));
    }
  });
  handler.openIframe();
};
</script>
            </div>
        </div>
    </div>
</section>
    </main>

    <template id="income-template">
  <div class="income-source-block" data-source-id="_INDEX">
    <div class="income-header">
      <h3>Income Source <span class="income-index">1</span></h3>
      <button type="button" class="remove-btn" onclick="removeIncomeSource(this)">Remove</button>
    </div>

    <div class="input-row">
      <div class="input-group">
        <label for="type_INDEX">Source Type</label>
        <select id="type_INDEX" class="income-type" onchange="handleIncomeTypeChange(this)">
          <option value="salary">Salary/Employment</option>
          <option value="self">Self-Employment/Business</option>
          <option value="rental">Rental Income</option>
          <option value="investment">Investment Income</option>
          <option value="other">Other Income</option>
        </select>
      </div>
      <div class="input-group">
        <label for="freq_INDEX">Frequency</label>
        <select id="freq_INDEX" class="income-frequency" onchange="toggleMonthlyInputs(this); handleIncomeTypeChange(document.getElementById('type_INDEX'))">
          <option value="annual">Annual Income (Gross)</option>
          <option value="monthly">Monthly Breakdown</option>
        </select>
      </div>
    </div>

    <!-- GROSS INCOME -->
    <div class="input-group gross-income-container">
      <label for="income_INDEX">Gross Annual Income (â‚¦)</label>
      <div class="tooltip">
        <input type="text" id="income_INDEX" class="gross-income" 
               oninput="updateFormattedValue(this)" 
               placeholder="e.g., 1,500,000">
        <span class="tooltiptext">Total income earned in the year before taxes and deductions.</span>
      </div>
    </div>

    <!-- MONTHLY BREAKDOWN -->
    <div class="monthly-income-container" style="display: none;">
      <div class="input-group">
        <label>Gross Monthly Income Breakdown (â‚¦)</label>
        <div class="monthly-income-row">
          <!-- JAN -->
          <div class="input-group">
            <label for="jan_INDEX">Jan</label>
            <input type="text" id="jan_INDEX" data-month="Jan"
                   oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
            <div class="clickable-tooltip">
              <div class="tooltip-popup">Total income earned per month before taxes and deductions.</div>
            </div>
          </div>
          <!-- FEB -->
          <div class="input-group">
            <label for="feb_INDEX">Feb</label>
            <input type="text" id="feb_INDEX" data-month="Feb" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
          </div>
          <!-- MAR -->
          <div class="input-group">
            <label for="mar_INDEX">Mar</label>
            <input type="text" id="mar_INDEX" data-month="Mar" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
          </div>
          <!-- APR -->
          <div class="input-group">
            <label for="apr_INDEX">Apr</label>
            <input type="text" id="apr_INDEX" data-month="Apr" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
          </div>
          <!-- MAY -->
          <div class="input-group">
            <label for="may_INDEX">May</label>
            <input type="text" id="may_INDEX" data-month="May" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
          </div>
          <!-- JUN -->
          <div class="input-group">
            <label for="jun_INDEX">Jun</label>
            <input type="text" id="jun_INDEX" data-month="Jun" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
          </div>
          <!-- JUL -->
          <div class="input-group">
            <label for="jul_INDEX">Jul</label>
            <input type="text" id="jul_INDEX" data-month="Jul" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
          </div>
          <!-- AUG -->
          <div class="input-group">
            <label for="aug_INDEX">Aug</label>
            <input type="text" id="aug_INDEX" data-month="Aug" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
          </div>
          <!-- SEP -->
          <div class="input-group">
            <label for="sep_INDEX">Sep</label>
            <input type="text" id="sep_INDEX" data-month="Sep" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
          </div>
          <!-- OCT -->
          <div class="input-group">
            <label for="oct_INDEX">Oct</label>
            <input type="text" id="oct_INDEX" data-month="Oct" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
          </div>
          <!-- NOV -->
          <div class="input-group">
            <label for="nov_INDEX">Nov</label>
            <input type="text" id="nov_INDEX" data-month="Nov" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
          </div>
          <!-- DEC -->
          <div class="input-group">
            <label for="dec_INDEX">Dec</label>
            <input type="text" id="dec_INDEX" data-month="Dec" oninput="updateFormattedValue(this); updateMonthlyTotal(this); markManualEdit(this)">
          </div>
        </div>
        <div class="monthly-total">Total Annual Income: â‚¦0</div>
      </div>
    </div>

    <!-- WHT CREDIT (only for rental/investment/other) -->
<div class="input-group wht-row" style="display:none;">
  <label for="wht_INDEX">WHT Already Deducted/Paid (â‚¦)</label>
  <div class="tooltip">
    <input type="text" id="wht_INDEX" class="wht-input" oninput="updateFormattedValue(this)" placeholder="e.g 200,000...Omit if unsure.">
    <span class="tooltiptext">This is tax already deducted by tenant/bank. It reduces your final tax.</span>
  </div>
</div>
  </div>
</template>
<!-- FLOATING CHAT -->
<div id="taxc-chat-widget">
  <div class="chat-launcher" onclick="toggleChat()" aria-label="Chat with TaxC AI">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
    <div class="chat-tooltip">Chat with Ada</div>
  </div>
  <div class="chat-window" id="chat-window">
    <div class="chat-header">
      Ada â€” TaxC AI
      <button class="chat-clear" onclick="clearChat()" title="Clear chat">Clear</button>
      <button class="chat-close" onclick="toggleChat()">Ã—</button>
    </div>
    <div class="chat-body" id="chat-body">
    </div>
    <div class="chat-input">
      <input type="text" id="chat-input" placeholder="Type here..." onkeypress="if(event.key==='Enter') sendMessage()">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
</div>

    <footer class="fade-in">
    &copy; 2025 TaxC â€” Made with care. | <a href="mailto:support@taxc.com.ng">support@taxc.com.ng</a>
</footer>

    <script>
        
// === ADA v6.0 â€” HACKATHON DEMO GOD MODE (Fixed Everything) ===
const Ada = {
  memory: { name: "" },
  faqs: {
    "what taxes does taxc calculate": "TaxC calculates your Personal Income Tax (PIT) based on Nigeriaâ€™s 2025/2026 Nigerian Tax Act (NTA) rules. This includes income from salary, self-employment, rental, investments, and other sources, factoring in allowable deductions like pension contributions and rent relief (up to â‚¦500,000).",
    "who needs to pay personal income tax": "Every Nigerian resident earning income above â‚¦800,000 annually (after deductions) is required to pay Personal Income Tax to their State Internal Revenue Service (IRS). This includes salaried employees, self-employed individuals, and those with rental or investment income.",
    "how does taxc handle deductions": "TaxC allows you to input pension contributions and annual rent paid. For salaried or self-employed individuals, rent relief is calculated as 20% of your rent, capped at â‚¦500,000. These deductions reduce your taxable income, lowering your tax liability. Other deductions may include life insurance, NHF, etc.",
    "what is withholding tax": "Withholding Tax (WHT) is a tax deducted at source on certain incomes, like rental income (10%), or investment income (10%). TaxC lets you input WHT paid or applies default rates, which are credited against your final tax liability to avoid double taxation.",
    "is my data safe": "Yes, TaxC prioritizes your privacy. We donâ€™t store sensitive payment informationâ€”payments are securely handled by Paystack. Your input data is used only for calculations and report generation, and we adhere to strict data protection standards.",
    "whatâ€™s included in the pdf report": "The PDF report includes a step-by-step breakdown of your tax calculation, deduction summary (pension, rent relief, etc), tax band details, and filing guidance tailored to your stateâ€™s IRS. Itâ€™s perfect for keeping records or sharing with a tax agent.",
    "how do i file my taxes": "TaxC provides an estimate to guide you. To file, submit your tax details to your State IRS, either online via their portal or in person. Our â‚¦500 report includes specific filing guidance for your state.",
    "can taxc help with business taxes": "Currently, TaxC focuses on Personal Income Tax for individuals. For business or corporate taxes, consult a tax professional or contact your State IRS. Our eBooks may offer additional resources for business owners."
  },

  init() {
    const saved = localStorage.getItem('taxc_user_name');
    if (saved) this.memory.name = saved;
  },

  saveName(name) {
    this.memory.name = name;
    localStorage.setItem('taxc_user_name', name);
  },

  greet() {
    return this.memory.name ? `Welcome back, ${this.memory.name}! ` : "";
  },

  respond(input) {
  const l = input.toLowerCase().trim();

  // === 1. GREETINGS ===
  if (/^(hi|hello|hey|howfar|hi ada|hello ada)/i.test(input)) {
    return `Howfar! Wetin you wan know about tax?`;
  }

  // === 2. NAME ===
  if (l.includes("my name is") || l.includes("call me") || l.includes("i am")) {
    const match = input.match(/(?:my name is|call me|i am) ([\w\s]+)/i);
    if (match) {
      this.saveName(match[1].trim());
      return `Got it, ${match[1].trim()}! No wahala, I dey your back. Wetin you wan calculate?`;
    }
  }

  // === 3. DIRECT FAQ â€” FULL ANSWERS WITH <br> SPACING ===

  // ---- "calculate tax" ----
  if (l.includes("calculate") && l.includes("tax") || l.includes("how much") && l.includes("tax") || l.includes("owe")) {
    return `
      Letâ€™s calculate your tax in **3 steps**:<br><br>
      1. <strong>Add income</strong> â†’ Salary, rent, investments, etc.<br>
      2. <strong>Enter deductions</strong> â†’ Pension, rent (up to â‚¦500k relief)<br>
      3. <strong>Pick your state</strong> â†’ Click **Calculate!**<br><br>

      <button class="chat-btn" onclick="location.href='index.html#calculator'">Go to Calculator</button>
    `;
  }

  // ---- "who pays tax" ----
  if (l.includes("who") && l.includes("pay") && l.includes("tax") || l.includes("who needs to pay")) {
    return `
      Every Nigerian earning above â‚¦800,000 per year (after deductions) must pay Personal Income Tax (PIT) to their State Internal Revenue Service (IRS).<br><br>

      This includes:<br>
      â€¢ Salaried employees<br>
      â€¢ Self-employed individuals<br>
      â€¢ Landlords with rental income<br>
      â€¢ Investors with dividends, interest, etc.<br><br>

      <em>Even if your employer deducts PAYE, you still file annually to reconcile.</em><br><br>

      Want to check if you owe? Letâ€™s calculate â†’ 
      <button class="chat-btn" onclick="location.href='index.html#calculator'">Go to Calculator</button>
    `;
  }

  // === 4. FAQ (fallback) ===
  for (const [key, answer] of Object.entries(this.faqs)) {
    const keywords = key.split(' ').filter(w => w.length > 3);
    if (keywords.some(k => l.includes(k))) {
      return `${answer} <br><br><em>You dey pay tax? No wahala, I go help you!</em>`;
    }
  }

  // === 5. FREE EBOOKS ===
  if (l.includes("free") || l.includes("ebook") || l.includes("download") || l.includes("book")) {
    return `
      I get **3 FREE eBooks** for you:
      <ul>
        <li>Who Pays Tax in Nigeria?</li>
        <li>What is P.I.T.?</li>
        <li>Am I Tax Eligible? (Quiz)</li>
      </ul>
      <button class="chat-btn" onclick="location.href='ebooks.html#free'">View All Ebooks</button>
    `;
  }

  // === 6. DEFAULT ===
  return `
    ${this.greet()}I fit help you with:
    <ul>
      <li>Who dey pay tax?</li>
      <li>How to file?</li>
      <li>Free eBooks</li>
      <li>Calculate tax</li>
    </ul>
    Just ask!
    <br><br>
    <button class="chat-btn" onclick="location.href='mailto:support@taxc.com.ng'">Contact Support</button>
  `;
}
};

// === CHAT UI ===
let hasNewMessage = false;

function toggleChat() {
Â  const win = document.getElementById('chat-window');
Â  const launcher = document.querySelector('.chat-launcher');
Â  win.style.display = win.style.display === 'flex' ? 'none' : 'flex';
Â  if (win.style.display === 'flex') {
Â  Â  hasNewMessage = false;
Â  Â  launcher.classList.remove('has-notification');
Â  Â  // â­ NEW: Clear the unread status when the chat is opened/read
Â  Â  localStorage.removeItem('taxc_ai_has_unread'); 

Â  Â  setTimeout(() => document.getElementById('chat-input')?.focus(), 300);
Â  }
}

// -------------------------------------------------
// SAVE CHAT HISTORY TO LOCALSTORAGE
// -------------------------------------------------
function saveChat() {
  const messages = [];
  document.querySelectorAll('#chat-body .message').forEach(msg => {
    messages.push({
      text: msg.innerHTML,
      type: msg.classList.contains('user') ? 'user' : 'ai'
    });
  });
  localStorage.setItem('taxc_chat_history', JSON.stringify(messages));
}

function addMessage(text, type, isInitialLoad = false) {
Â  const body = document.getElementById('chat-body');
Â  const div = document.createElement('div');
Â  div.className = `message ${type}`;
Â  div.innerHTML = text;
Â  body.appendChild(div);
Â  body.scrollTop = body.scrollHeight;
Â  saveChat();

Â  // === PLAY SOUND ONLY FOR ADA'S REAL REPLY (not loading dots) ===
Â  if (type === 'ai' && window.adaSound && !text.includes('typing')) {
Â  Â  window.adaSound.currentTime = 0;
Â  Â  window.adaSound.play().catch(() => {});
Â  }

Â  // === NOTIFICATION BUBBLE (when chat is closed) ===
Â  // Trigger only if it's an AI message, NOT an initial load, and the chat is closed
Â  if (type === 'ai' && !isInitialLoad && document.getElementById('chat-window').style.display !== 'flex') {
Â  Â  hasNewMessage = true;
Â  Â  document.querySelector('.chat-launcher').classList.add('has-notification');
Â  Â  // â­ NEW: Persist the unread status in localStorage
Â  Â  localStorage.setItem('taxc_ai_has_unread', 'true'); 
Â  }
}

// -------------------------------------------------
// CLEAR CHAT + CONFIRM
// -------------------------------------------------
function clearChat() {
  if (confirm("Are you sure you want to clear chat?")) {
    document.getElementById('chat-body').innerHTML = '';
    localStorage.removeItem('taxc_chat_history');
  }
}

function sendMessage() {
  const input = document.getElementById('chat-input');
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, 'user');
  input.value = '';
  addMessage('<i class="typing">â€¢â€¢â€¢</i>', 'ai');

  setTimeout(() => {
    const messages = document.querySelectorAll('.message');
    if (messages.length > 0) messages[messages.length - 1].remove();
    addMessage(Ada.respond(text), 'ai');
  }, 1000);
}

document.addEventListener('DOMContentLoaded', () => {
Â  Ada.init();
Â  
Â  // â­ NEW: Check and apply saved notification status immediately on page load
Â  const launcher = document.querySelector('.chat-launcher');
Â  if (localStorage.getItem('taxc_ai_has_unread') === 'true') {
Â  Â  launcher.classList.add('has-notification');
Â  }

Â  // ==== LOAD PREVIOUS CHAT ====
Â  const savedChat = localStorage.getItem('taxc_chat_history');
Â  if (savedChat) {
Â  Â  const messages = JSON.parse(savedChat);
Â  Â  // Pass 'true' to ensure history re-load doesn't re-trigger notification
Â  Â  messages.forEach(msg => addMessage(msg.text, msg.type, true)); 
Â  }

Â  // === INIT ADA SOUND ===
Â  const adaSound = document.getElementById('ada-message-sound');
Â  if (adaSound) {
Â  Â  adaSound.volume = 0.6;
Â  Â  window.adaSound = adaSound;
Â  }

Â  // ==== FIRST-TIME WELCOME (if no name & no chat) ====
Â  if (!Ada.memory.name && !savedChat) {
Â  Â  // Pass 'true' to prevent this greeting from triggering a notification
Â  Â  addMessage("Hi! I'm <strong>Ada</strong>, your personal tax assistant. Ask me anything about taxes, filing, or ebooks!", 'ai', true); 
Â  }

Â  // === ONLY SHOW "WELCOME BACK" IF NO CHAT HISTORY ===
Â  if (Ada.memory.name) {
Â  Â  const hasChat = localStorage.getItem('taxc_chat_history') && 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  JSON.parse(localStorage.getItem('taxc_chat_history')).length > 0;
Â  Â  
Â  Â  if (!hasChat) {
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  // Pass 'true' to prevent this greeting from triggering a notification
Â  Â  Â  Â  addMessage(`Welcome back, ${Ada.memory.name}! Howfar today?`, 'ai', true); 
Â  Â  Â  }, 800);
Â  Â  }
Â  }
});

// === CSS: Notification Badge + Clean Numbers ===
const style = document.createElement('style');
style.textContent = `
  .chat-btn {
    background: #28A745; color: white; border: none; padding: 10px 18px;
    border-radius: 8px; cursor: pointer; font-weight: 600; margin: 8px 0;
    display: inline-block; font-size: 0.95rem; box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    transition: all 0.2s;
  }
  .chat-btn:hover { background: #218838; transform: translateY(-1px); }

  .typing { animation: blink 1s infinite; }
  @keyframes blink { 0%,100% { opacity: 1 } 50% { opacity: 0.3 } }

  /* === FIXED: Clean Numbering === */
  .message ol {
    counter-reset: item;
    padding-left: 0;
    margin: 12px 0;
  }
  .message ol li {
    display: block;
    margin: 10px 0;
    padding-left: 30px;
    position: relative;
    line-height: 1.5;
  }
  .message ol li:before {
    content: counter(item);
    counter-increment: item;
    position: absolute;
    left: 0;
    background: #28A745;
    color: white;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 0.85rem;
  }

  /* === NOTIFICATION BADGE === */
  .chat-launcher {
    position: relative;
  }
  .chat-launcher.has-notification::after {
    content: '';
    position: absolute;
    top: 8px;
    right: 8px;
    width: 12px;
    height: 12px;
    background: #ff3b30;
    border-radius: 50%;
    border: 2px solid white;
    animation: pulse-badge 2s infinite;
  }
  @keyframes pulse-badge {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
  }
`;
document.head.appendChild(style);

        
        // Placeholder functions for showTooltip and hideTooltip
        function showTooltip(element, text) {
            if (element) {
                element.textContent = text || element.textContent;
                element.style.visibility = 'visible';
                element.style.opacity = '1';
            }
        }
        function hideTooltip(element) {
            if (element) {
                element.style.visibility = 'hidden';
                element.style.opacity = '0';
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('menu');
            const hamburger = document.getElementById('hamburger');

            if (menu.hasAttribute('open')) {
                menu.removeAttribute('open');
                hamburger.classList.remove('is-active');
            } else {
                menu.setAttribute('open', '');
                hamburger.classList.add('is-active');
                const dropdown = menu.querySelector('.nav-dropdown-menu');
                if (dropdown && dropdown.hasAttribute('open')) {
                    dropdown.removeAttribute('open');
                }
            }
        }

        function scrollToSection(event) {
            event.preventDefault();
            const href = event.target.getAttribute('href');
            const targetId = href.substring(1); 
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
            }
            toggleMobileMenu(); 
        }

        function getRawValue(inputElement) {
            if (!inputElement) return 0;
            const value = inputElement.value.replace(/[^0-9]/g, '');
            return Number(value) || 0;
        }

        function updateFormattedValue(input) {
            let value = input.value.replace(/[^0-9]/g, '');
            if (value === '') {
                input.value = '';
                return;
            }
            const rawValue = Number(value);
            input.value = rawValue.toLocaleString('en-NG');
        }

        function updateMonthlyTotal(input) {
            const block = input.closest('.income-source-block');
            if (!block) return;
            
            const monthlyInputs = block.querySelectorAll('.monthly-income-row input');
            let total = 0;
            monthlyInputs.forEach(inp => {
                const value = getRawValue(inp);
                total += value;
            });
            const totalDisplay = block.querySelector('.monthly-total');
            if (totalDisplay) {
                totalDisplay.textContent = `Total Annual Income: â‚¦${total.toLocaleString('en-NG')}`;
            }
        }

        function markManualEdit(input) {
            input.dataset.manual = 'true';
        }

        function handleMonthlySalaryAutoFill(block) {
    const monthlyInputs = block.querySelectorAll('.monthly-income-row input');
    const januaryInput = monthlyInputs[0];

    // 1. Remove existing handler to prevent duplicates
    if (januaryInput.autoFillHandler) {
        januaryInput.removeEventListener('input', januaryInput.autoFillHandler);
        januaryInput.autoFillHandler = null;
    }

    if (block.querySelector('.income-type').value === 'salary' && block.querySelector('.income-frequency').value === 'monthly') {
        const autoFillHandler = (e) => {
            // Prevent recursive calls when dispatching the event below
            if (e.isTrusted === false && e.type === 'input') return;

            const janValueRaw = getRawValue(januaryInput); // Get the raw number value
            const janFormattedValue = januaryInput.value; // Get the formatted string

            monthlyInputs.forEach((input, index) => {
                // Skip January (index 0)
                // Skip any month that has been manually edited by the user
                if (index !== 0 && input.dataset.manual !== 'true') {
                    
                    if (janValueRaw === 0) {
                        // FIX: Clear the input if January is empty/zero
                        input.value = '';
                    } else {
                        // FIX: Use the formatted string from Jan
                        input.value = janFormattedValue;
                    }
                    
                    // Manually trigger total update on these fields. 
                    // We don't dispatch an 'input' event because it can cause infinite loops
                    // due to the updateFormattedValue(this) and updateMonthlyTotal(this) calls.
                    // Instead, we just call updateMonthlyTotal once after the loop.
                }
            });
            
            // Recalculate the total annual income once after the loop finishes
            updateMonthlyTotal(januaryInput);
        };

        januaryInput.autoFillHandler = autoFillHandler;
        januaryInput.addEventListener('input', autoFillHandler);

        // If January already has a value when the function runs, trigger a fill
        if (januaryInput.value) {
            januaryInput.dispatchEvent(new Event('input'));
        }
    }
}

        function handleIncomeTypeChange(selectEl) {
            const block = selectEl.closest('.income-source-block');
            
            toggleWhtField(selectEl);
            
            const januaryInput = block.querySelector('.monthly-income-row input[data-month="Jan"]');
            if (januaryInput) {
                if (januaryInput.autoFillHandler) {
                    januaryInput.removeEventListener('input', januaryInput.autoFillHandler);
                    januaryInput.autoFillHandler = null;
                }
                if (selectEl.value === 'salary' && block.querySelector('.income-frequency').value === 'monthly') {
                    handleMonthlySalaryAutoFill(block);
                }
            }
        }

        function toggleMonthlyInputs(selectEl) {
            const block = selectEl.closest('.income-source-block');
            const monthlyContainer = block.querySelector('.monthly-income-container');
            const grossIncomeContainer = block.querySelector('.gross-income-container');
            const typeSelect = block.querySelector('.income-type');

            if (selectEl.value === 'monthly') {
                monthlyContainer.style.display = 'block';
                grossIncomeContainer.style.display = 'none';
                if (block.querySelector('.gross-income')) block.querySelector('.gross-income').value = '';
                
                handleIncomeTypeChange(typeSelect); 
                
                const firstMonthlyInput = block.querySelector('.monthly-income-row input');
                if(firstMonthlyInput) updateMonthlyTotal(firstMonthlyInput);
            } else {
                monthlyContainer.style.display = 'none';
                grossIncomeContainer.style.display = 'block';
                
                const januaryInput = block.querySelector('.monthly-income-row input[data-month="Jan"]');
                if (januaryInput && januaryInput.autoFillHandler) {
                    januaryInput.removeEventListener('input', januaryInput.autoFillHandler);
                    januaryInput.autoFillHandler = null;
                }

                block.querySelectorAll('.monthly-income-row input').forEach(input => {
                    input.value = '';
                    input.dataset.manual = 'false';
                });
                const monthlyTotal = block.querySelector('.monthly-total');
                if(monthlyTotal) monthlyTotal.textContent = 'Total Annual Income: â‚¦0';
            }
        }

        function toggleWhtField(selectElement) {
    const type = selectElement.value;
    const block = selectElement.closest('.income-source-block');
    const whtRow = block.querySelector('.wht-row');
    const tooltip = block.querySelector('.wht-row .tooltiptext');

    if (!whtRow) return;

    if (type === 'rental' || type === 'investment') {
        whtRow.style.display = 'flex';
        tooltip.innerHTML = `
            WHT = 10% tax your tenant/bank pays to govt BEFORE giving you the rest.
            Leave blank â†’ we use standard 10%.
        `;
    } else {
        whtRow.style.display = 'none';
        // Clear input when hidden
        const input = block.querySelector('.wht-input');
        if (input) input.value = '';
    }
}

        function addIncomeSource() {
            const template = document.getElementById('income-template');
            const container = document.getElementById('income-sources-container');
            const newIndex = container.children.length;

            const clone = document.importNode(template.content, true);
            const block = clone.querySelector('.income-source-block');

            block.setAttribute('data-source-id', newIndex);
            block.querySelector('.income-index').textContent = newIndex + 1;
            
            let htmlContent = block.innerHTML;
            htmlContent = htmlContent.replace(/_INDEX/g, `_${newIndex}`);
            block.innerHTML = htmlContent;

            container.appendChild(clone);
            const newBlock = container.lastElementChild;

            const grossIncomeInput = newBlock.querySelector(`#income_${newIndex}`);
            const monthlyInputs = newBlock.querySelectorAll('.monthly-income-container input[type="text"]');
            const whtInput = newBlock.querySelector(`#wht_${newIndex}`);
            const typeSelect = newBlock.querySelector(`#type_${newIndex}`);
            const frequencySelect = newBlock.querySelector(`#freq_${newIndex}`);

            if (grossIncomeInput) {
                grossIncomeInput.addEventListener('input', () => updateFormattedValue(grossIncomeInput));
            }
            if (whtInput) {
                whtInput.addEventListener('input', () => updateFormattedValue(whtInput));
            }
            
            monthlyInputs.forEach(input => {
                input.addEventListener('input', () => updateFormattedValue(input));
                input.addEventListener('input', () => updateMonthlyTotal(input));
                input.addEventListener('input', () => markManualEdit(input));
            });

            typeSelect.addEventListener('change', () => handleIncomeTypeChange(typeSelect));
            frequencySelect.addEventListener('change', () => toggleMonthlyInputs(frequencySelect));
            
            const grossTooltip = newBlock.querySelector('.gross-income-container .tooltip .tooltiptext');
            if (grossIncomeInput) {
                grossIncomeInput.addEventListener('focus', () => showTooltip(grossTooltip, "Total income earned in the year before taxes and deductions."));
                grossIncomeInput.addEventListener('blur', () => hideTooltip(grossTooltip));
            }

            const whtTooltip = newBlock.querySelector('.wht-row .tooltip .tooltiptext');
            if (whtInput) {
                whtInput.addEventListener('focus', () => showTooltip(whtTooltip)); 
                whtInput.addEventListener('blur', () => hideTooltip(whtTooltip));
            }

            newBlock.querySelector('.remove-btn').addEventListener('click', (e) => {
                e.preventDefault();
                removeIncomeSource(e.currentTarget);
            });

            const allBlocks = document.querySelectorAll('.income-source-block');
            allBlocks.forEach(b => {
                b.querySelector('.remove-btn').style.display = allBlocks.length > 1 ? 'flex' : 'none';
            });

            toggleWhtField(typeSelect);
            toggleMonthlyInputs(frequencySelect);
        }

        function removeIncomeSource(button) {
            const blockToRemove = button.closest('.income-source-block');
            blockToRemove.remove();

            const container = document.getElementById('income-sources-container');
            const remainingBlocks = container.querySelectorAll('.income-source-block');
            
            remainingBlocks.forEach((block, index) => {
                block.setAttribute('data-source-id', index);
                block.querySelector('.income-index').textContent = index + 1;
                
                const oldIndexRegex = /_\d+/;
                
                block.querySelectorAll('[id*="_"], [for*="_"]').forEach(el => {
                    const attrName = el.hasAttribute('id') ? 'id' : 'for';
                    let value = el.getAttribute(attrName);
                    
                    const match = value.match(oldIndexRegex);
                    if (match) {
                        value = value.replace(match[0], `_${index}`);
                        el.setAttribute(attrName, value);
                    }
                });
                const typeSelect = block.querySelector('.income-type');
                if (typeSelect) handleIncomeTypeChange(typeSelect);

            });

            if (remainingBlocks.length === 1) {
                remainingBlocks[0].querySelector('.remove-btn').style.display = 'none';
            }
        }

        function validateForm() {
            const outputDiv = document.getElementById('output');
            const msgDiv = document.getElementById('msg');
            const taxSummary = document.getElementById('taxSummary');
            const defaultMessage = document.getElementById('default-report-message');
            msgDiv.textContent = '';
            taxSummary.innerHTML = ''; // Clear previous summary
            defaultMessage.style.display = 'none'; // Hide placeholder during validation
            outputDiv.style.display = 'none'; // Hide output by default

            const incomeBlocks = document.querySelectorAll('.income-source-block');
            if (incomeBlocks.length === 0) {
                msgDiv.textContent = 'Please add at least one income source.';
                outputDiv.style.display = 'block';
                return false;
            }

            let validationPassed = true;
            let totalGrossIncomeCheck = 0;

            for (const block of incomeBlocks) {
                const frequency = block.querySelector('.income-frequency').value;
                const blockIndex = block.getAttribute('data-source-id');
                let incomeInputs = [];

                if (frequency === 'monthly') {
                    incomeInputs = block.querySelectorAll('.monthly-income-container input[type="text"]');
                } else {
                    incomeInputs = [block.querySelector(`#income_${blockIndex}`)];
                }
                
                incomeInputs.forEach(input => {
                    const rawValue = getRawValue(input);
                    if (rawValue < 0) {
                        msgDiv.textContent = 'Income amounts cannot be negative. Please check your inputs.';
                        validationPassed = false;
                    }
                    totalGrossIncomeCheck += rawValue;
                });
                
                const whtRow = block.querySelector('.wht-row');
                if (whtRow && whtRow.style.display !== 'none') {
                    const whtInput = block.querySelector(`#wht_${blockIndex}`);
                    const whtValue = getRawValue(whtInput);
                    if (whtValue < 0) {
                        msgDiv.textContent = 'WHT paid cannot be negative. Please correct the amount.';
                        validationPassed = false;
                    }
                }
            }

            const pension = getRawValue(document.getElementById('pension'));
            const rent = getRawValue(document.getElementById('rent'));
            
            if (pension < 0 || rent < 0) {
                msgDiv.textContent = 'Deduction amounts (Pension/Rent) cannot be negative.';
                validationPassed = false;
            }
            
            if (totalGrossIncomeCheck <= 0) {
                msgDiv.textContent = 'Total annual income must be greater than zero to calculate.';
                validationPassed = false;
            }
            
                        if (!validationPassed) {
    document.getElementById('msg').textContent = 'ðŸ”´ Please fill the above';
    document.getElementById('taxSummary').innerHTML = '';
    document.getElementById('default-report-message').style.display = 'block';
    document.getElementById('output').style.display = 'block';

    // â† ADD THIS LINE
    document.querySelector('#report').scrollIntoView({ behavior: 'smooth' });

    return false;
}
            
            return true;
        }

function calculateTax() {
    const state = document.getElementById('state').value;

    // 1. FIRST check if income is missing â†’ show the generic red message
    if (!validateForm()) {
        // validateForm() already sets the correct red message + shows placeholder
        return;
    }

    // 2. NOW check state â†’ only if income is valid
    if (!state) {
        document.getElementById('msg').innerHTML = 'ðŸ”´ Please select your State of Residence to proceed with the tax calculation.';
        document.getElementById('taxSummary').innerHTML = '';
        document.getElementById('default-report-message').style.display = 'block';
        document.getElementById('output').style.display = 'block';
        document.getElementById('state').scrollIntoView({ behavior: 'smooth' });
        return;
    }

    let totalGross = 0;
    let totalWhtCredit = 0;

    // === Collect all income ===
    document.querySelectorAll('.income-source-block').forEach(block => {
        const index = block.getAttribute('data-source-id');
        const type = document.getElementById(`type_${index}`).value;
        const freq = document.getElementById(`freq_${index}`).value;

        let income = 0;
        if (freq === 'monthly') {
            block.querySelectorAll('.monthly-income-row input').forEach(inp => {
                income += getRawValue(inp);
            });
        } else {
            income = getRawValue(document.getElementById(`income_${index}`));
        }
        totalGross += income;

        // WHT Credit only
        if (['rental', 'investment', 'other'].includes(type)) {
            const whtInput = document.getElementById(`wht_${index}`);
            let wht = getRawValue(whtInput);
            if (wht === 0) wht = income * (type === 'other' ? 0.05 : 0.10);
            totalWhtCredit += wht;
        }
    });

    // === Deductions ===
    const pension = getRawValue(document.getElementById('pension') || {value:''});
    const nhf = getRawValue(document.getElementById('nhf') || {value:''});
    const nhis = getRawValue(document.getElementById('nhis') || {value:''});
    const life = getRawValue(document.getElementById('lifeinsurance') || {value:''});
    const mortgage = getRawValue(document.getElementById('mortgage') || {value:''});
    const rentPaid = getRawValue(document.getElementById('rent') || {value:''});
    const rentRelief = Math.min(200000, rentPaid); // 2026 cap

    const totalDeductions = pension + nhf + nhis + life + mortgage + rentRelief;
    const taxableIncome = Math.max(0, totalGross - totalDeductions);
    const chargeableIncome = Math.max(0, taxableIncome - 800000); // First 800k exempt

    // === Tax bands ===
    let tax = 0;
    let remaining = chargeableIncome;

    if (remaining > 0) tax += Math.min(remaining, 2200000) * 0.15; remaining -= 2200000;
    if (remaining > 0) tax += Math.min(remaining, 9000000) * 0.18; remaining -= 9000000;
    if (remaining > 0) tax += Math.min(remaining, 13000000) * 0.21; remaining -= 13000000;
    if (remaining > 0) tax += Math.min(remaining, 25000000) * 0.23; remaining -= 25000000;
    if (remaining > 0) tax += remaining * 0.25;

    const finalTax = Math.max(0, tax - totalWhtCredit);
    const monthlyTax = finalTax / 12;

    // === Display ===
    document.getElementById('taxSummary').innerHTML = `
        <strong>2026 Personal Income Tax (New Law)</strong><br><br>
        Gross Annual Income: â‚¦${totalGross.toLocaleString('en-NG')}<br>
        Total Deductions: â‚¦${totalDeductions.toLocaleString('en-NG')}<br>
        Taxable Income: â‚¦${taxableIncome.toLocaleString('en-NG')}<br>
        <strong>Chargeable Income (after â‚¦800k exemption):</strong> â‚¦${chargeableIncome.toLocaleString('en-NG')}<br><br>
        <strong>Tax Before WHT Credit:</strong> â‚¦${tax.toLocaleString('en-NG')}<br>
        ${totalWhtCredit > 0 ? `<strong>WHT Credit:</strong> â‚¦${totalWhtCredit.toLocaleString('en-NG')}<br>` : ''}
        <strong>Final Tax Payable:</strong> â‚¦${Math.round(finalTax).toLocaleString('en-NG')}<br>
        <strong>Monthly PAYE (approx):</strong> â‚¦${Math.round(monthlyTax).toLocaleString('en-NG')}<br><br>
        <em>Valid for income earned from January 2026</em>
    `;

    document.getElementById('msg').textContent = 'Calculation complete (2026 rules applied)';
    document.getElementById('output').style.display = 'block';
    document.querySelector('#report').scrollIntoView({behavior: 'smooth'});
        document.getElementById('default-report-message').style.display = 'none';  // â† ADD THIS
    window.lastCalc = { finalTax, state };
}

function generatePDFReport() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Title
    doc.setFontSize(18);
    doc.setTextColor(40, 167, 69);
    doc.text('TaxC â€” Your 2025 Tax Report', 105, 20, { align: 'center' });

    // Summary
    doc.setFontSize(12);
    doc.setTextColor(0);
    let y = 40;
    const lines = document.getElementById('taxSummary').innerText.split('\n');
    lines.forEach(line => {
        if (line.trim()) {
            doc.text(line, 20, y);
            y += 8;
        }
    });

    // Footer
    doc.setFontSize(10);
    doc.setTextColor(100);
    doc.text(`Generated on ${new Date().toLocaleDateString('en-NG')} | taxc.com.ng`, 105, 280, { align: 'center' });

    // Trigger download
    doc.save('TaxC_Report_2025.pdf');
    
    // Success message
    document.getElementById('msg').innerHTML = 'Report downloaded! Check your Downloads folder.';
}

        function resetForm() {
    const outputDiv = document.getElementById('output');
    const msgDiv = document.getElementById('msg');
    const taxSummary = document.getElementById('taxSummary');
    const defaultMessage = document.getElementById('default-report-message');
    const stateSelect = document.getElementById('state');

    // Clear deduction fields
    document.getElementById('pension').value = '';
    document.getElementById('rent').value = '';

    // Clear state
    if (stateSelect) stateSelect.value = '';

    // Remove ALL income blocks
    document.querySelectorAll('.income-source-block').forEach(block => block.remove());

    // Add back exactly ONE clean income source
    addIncomeSource();

    // Reset output area
    outputDiv.style.display = 'block';
    msgDiv.textContent = 'Please fill the above';
    taxSummary.innerHTML = '';
    defaultMessage.style.display = 'block';

    // Clear any stored calculation
    window.lastCalc = null;

    // Scroll back to calculator
    document.getElementById('calculator').scrollIntoView({ behavior: 'smooth' });
}

document.addEventListener('DOMContentLoaded', () => {
    // 1. Add first income source
    addIncomeSource();

    // 2. Nav links (smooth scroll)
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', scrollToSection);
    });

    // 3. Format pension & rent
    ['pension', 'rent'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', () => updateFormattedValue(el));
    });

    // 4. SHOW TAX SUMMARY + PLACEHOLDER ON LOAD
    const output = document.getElementById('output');
    const msg = document.getElementById('msg');
    const defaultMsg = document.getElementById('default-report-message');

    output.style.display = 'block';
    msg.textContent = 'Please fill the above';
    defaultMsg.style.display = 'block';

    // 5. === DROPDOWN LOGIC (MERGED CLICK & HOVER) ===
    
    // Helper function to open a dropdown
    function openDropdown(dropdownId) {
        const dropdown = document.getElementById(dropdownId);
        if (!dropdown) return;
        
        // Close all other dropdowns
        document.querySelectorAll('.dropdown[open]').forEach(d => {
            if (d.id !== dropdownId) d.removeAttribute('open');
        });
        dropdown.setAttribute('open', '');
    }

    // Helper function to close a dropdown
    function closeDropdown(dropdownId) {
        const dropdown = document.getElementById(dropdownId);
        if (dropdown) dropdown.removeAttribute('open');
    }

    // --- A. Click-to-Toggle Logic (Original) ---
    function toggleDropdown(event, dropdownId) {
        event.stopPropagation();
        const dropdown = document.getElementById(dropdownId);
        const isOpen = dropdown.hasAttribute('open');
        
        // Use helper functions to ensure closure logic is centralized
        if (isOpen) {
            closeDropdown(dropdownId);
        } else {
            openDropdown(dropdownId);
        }
    }

    // Attach click listener to dropdown buttons
    document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
        const dropdownId = toggle.closest('.dropdown').id;
        // Keep the original click logic for touch/accessibility
        toggle.onclick = (e) => toggleDropdown(e, dropdownId);
    });

    // Close dropdown when clicking outside (Original)
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.dropdown')) {
            document.querySelectorAll('.dropdown[open]').forEach(d => {
                d.removeAttribute('open');
            });
        }
    });
    
    // --- B. Hover Logic (Added for Desktop) ---
    document.querySelectorAll('.dropdown').forEach(dropdown => {
        const dropdownId = dropdown.id;
        
        // Attach mouseover to open only on desktop screens
        dropdown.addEventListener('mouseover', function(e) {
            if (window.innerWidth >= 768) { // Check for desktop screens (adjust breakpoint as needed)
                openDropdown(dropdownId);
            }
        });

        // Attach mouseout to close only on desktop screens
        dropdown.addEventListener('mouseout', function(e) {
            if (window.innerWidth >= 768) {
                 setTimeout(() => {
                     // Check if the mouse is truly outside the dropdown area
                     if (!dropdown.contains(e.relatedTarget)) {
                        closeDropdown(dropdownId);
                     }
                 }, 100); 
            }
        });
    });
    // === END DROPDOWN LOGIC ===
});
        // Toggle tooltip on click (click-away closes it)
document.addEventListener('click', function (e) {
    const container = e.target.closest('.clickable-tooltip');
    // close any open tooltips
    document.querySelectorAll('.clickable-tooltip.active').forEach(el => {
        if (el !== container) el.classList.remove('active');
    });
    // open the clicked one
    if (container) {
        container.classList.toggle('active');
    }
});
function scrollToWhyReport(event) {
    if (event) {
        event.stopPropagation(); // <-- ADD THIS LINE
    }
    // 1. Close any open mobile menu first
    const menu = document.getElementById('menu');
    const hamburger = document.getElementById('hamburger');
    if (menu.hasAttribute('open')) {
        menu.removeAttribute('open');
        hamburger.classList.remove('is-active');
    }

    // 2. Get dropdowns
    const desktopDropdown = document.getElementById('desktop-dropdown');
    const mobileDropdown = document.getElementById('mobile-dropdown');

    // 3. Open BOTH dropdowns
    if (desktopDropdown) desktopDropdown.setAttribute('open', '');
    if (mobileDropdown) mobileDropdown.setAttribute('open', '');

    // 4. Re-open mobile menu if on mobile
    if (window.innerWidth < 768 && menu && hamburger) {
        setTimeout(() => {
            menu.setAttribute('open', '');
            hamburger.classList.add('is-active');
        }, 100); // Tiny delay so it opens AFTER scroll
    }

    // 5. Scroll to the dropdown (desktop or mobile)
    const target = window.innerWidth >= 768 ? desktopDropdown : menu;
    if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

window.addEventListener('beforeunload', saveChat);

        </script>
        <script src="scripts/scroll-animation.js"></script>
        <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD59PBKVQ_ocfAxWHsMsG0a3SE143Yp5zo",
    authDomain: "taxc-ebooks.firebaseapp.com",
    projectId: "taxc-ebooks",
    storageBucket: "taxc-ebooks.firebasestorage.app",
    messagingSenderId: "542476707940",
    appId: "1:542476707940:web:591fd5d3d6fd51eff95771"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const $ = id => document.getElementById(id);

  onAuthStateChanged(auth, user => {
    const loginBtns = document.querySelectorAll('#auth-button, #auth-button-mobile');
    const userDisplay = $('userDisplay');

    if (user && user.displayName) {
      const firstName = user.displayName.split(' ')[0];
      userDisplay.textContent = `Hi, ${firstName}!`;
      userDisplay.style.display = 'inline';
    } else {
      userDisplay.style.display = 'none';
    }

    loginBtns.forEach(btn => {
      if (user) {
        btn.innerHTML = 'Logout';
        btn.onclick = () => signOut(auth).then(() => location.reload());
      } else {
        btn.innerHTML = 'Login';
        btn.onclick = () => location.href = 'login.html?redirect=' + encodeURIComponent(location.href);
      }
    });
  });
</script>
<script>
// ==================== PAYSTACK INTEGRATION (TAXC 2025) ====================

// CHANGE THIS TO LIVE WHEN READY
const PAYSTACK_PUBLIC_KEY = "pk_test_xxxxxxxxxxxxxxxxxxxxxxxx"; // â† Put your real test key here
// const PAYSTACK_PUBLIC_KEY = "pk_live_xxxxxxxxxxxxxxxxxxxxxxxx"; // â† Live key (switch later)

let paymentInProgress = false;

// Main function user clicks
function payWithPaystack() {
  if (!window.lastCalc) {
    document.getElementById('msg').textContent = 'ðŸ”´ Please calculate your tax first.';
    return;
  }

  if (paymentInProgress) return;
  paymentInProgress = true;

  const btn = document.querySelector('.report-btn');
  btn.disabled = true;
  btn.textContent = "Opening secure checkout...";

  const email = prompt("Enter your email for the receipt & PDF delivery:", "");
  if (!email || !email.includes('@')) {
    alert("Valid email is required");
    btn.disabled = false;
    btn.textContent = "Pay â‚¦500 & Download PDF";
    paymentInProgress = false;
    return;
  }

  let handler = PaystackPop.setup({
    key: PAYSTACK_PUBLIC_KEY,
    email: email,
    amount: 50000, // â‚¦500 in kobo
    currency: "NGN",
    ref: 'TAXC_RPT_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),

    callback: function(response) {
      // Payment completed â€” now verify on backend
      verifyPaystackPayment(response.reference, email);
    },

    onClose: function() {
      btn.disabled = false;
      btn.textContent = "Pay â‚¦500 & Download PDF";
      paymentInProgress = false;
      document.getElementById('msg').innerHTML = 'Payment cancelled.';
    }
  });

  handler.openIframe();
}

// Called after Paystack callback
async function verifyPaystackPayment(reference, email) {
  const btn = document.querySelector('.report-btn');
  btn.textContent = "Verifying payment...";

  try {
    const res = await fetch('https://us-central1-taxc-ebooks.cloudfunctions.net/verifyPayment', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ reference, email, item: 'pdf_report' })
    });

    const data = await res.json();

    if (data.status === true) {
      document.getElementById('msg').innerHTML = 'Payment successful! Generating your professional PDF report...';
      btn.textContent = "Download Again";
      btn.disabled = false;
      btn.onclick = generatePDFReport;
      setTimeout(generatePDFReport, 1200); // Instant download
    } else {
      throw new Error(data.message || "Verification failed");
    }
  } catch (err) {
    console.error(err);
    document.getElementById('msg').innerHTML = 'Payment verification failed. Contact support@taxc.com.ng with ref: ' + reference;
    btn.disabled = false;
    btn.textContent = "Try Again";
    btn.onclick = payWithPaystack;
  } finally {
    paymentInProgress = false;
  }
}

// Change the button onclick
document.querySelector('.report-btn').onclick = payWithPaystack;
</script>
    </body>
</html>