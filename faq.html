<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaxC | FAQ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
    <link rel="icon" href="./favicon.ico">
    <link rel="manifest" href="./site.webmanifest">

    <link rel="stylesheet" href="styles/animations.css">

    <style>

    .chat-clear {
  position: absolute;
  right: 44px; /* Moves it left of the X */
  top: 50%;
  transform: translateY(-50%);
  background: #dc3545; /* Red */
  color: #fff;
  border: none;
  font-size: 0.75rem; /* Smaller text */
  padding: 4px 8px; /* Smaller button */
  border-radius: 4px;
  cursor: pointer;
  opacity: 0.9;
}
.chat-clear:hover {
  opacity: 1;
  background: #c82333;
}

/* MOBILE FIX: Move Clear further left + smaller */
@media (max-width: 480px) {
  .chat-clear {
    right: 35px; /* Closer to center on mobile */
    font-size: 0.7rem; /* Even smaller text */
    padding: 2px 6px; /* Tighter padding */
  }
  .chat-header {
    padding: 10px 8px; /* Less padding on mobile */
    font-size: 0.9rem; /* Smaller title text */
  }
  .chat-close {
    right: 5px; /* X closer to edge */
    font-size: 1.2rem; /* Slightly smaller X */
  }
}

        /* ——— CHAT WIDGET (same as index.html) ——— */
#taxc-chat-widget {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 10000;
}
.chat-launcher {
  position: relative;
  width: 60px;
  height: 60px;
  background: #28A745;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  transition: all .3s;
}
.chat-launcher:hover { transform: scale(1.1); background:#218838; }
.chat-launcher svg { width:28px; height:28px; }
.chat-tooltip {
  position:absolute; right:70px; top:50%; transform:translateY(-50%);
  background:#333; color:#fff; padding:8px 12px; border-radius:6px;
  font-size:.85rem; font-weight:600; white-space:nowrap;
  opacity:0; visibility:hidden; transition:all .3s;
}
.chat-tooltip::after{
  content:''; position:absolute; left:100%; top:50%; transform:translateY(-50%);
  border:6px solid transparent; border-left-color:#333;
}
.chat-launcher:hover .chat-tooltip{ opacity:1; visibility:visible; right:68px; }

.chat-window{display:none; width:340px; height:520px; background:#fff;

  border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.15);
  flex-direction:column; overflow:hidden; border:1px solid #eee;}
.chat-header{background:#28A745; color:#fff; padding:14px; font-weight:700;
  text-align:center; position:relative;}
.chat-header::before{content:""; display:inline-block; width:8px; height:8px;
  background:#fff; border-radius:50%; margin-right:8px; animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.chat-close{position:absolute; right:10px; top:50%; transform:translateY(-50%);
  background:none; border:none; color:#fff; font-size:1.4rem; cursor:pointer;}
.chat-body{flex:1; padding:15px; overflow-y:auto; background:#f8f9fa;}
.message{margin:10px 0; padding:10px 14px; border-radius:18px; max-width:80%;
  line-height:1.5; font-size:.95rem;}
.user{background:#28A745; color:#fff; margin-left:auto; border-bottom-right-radius:4px;}
.ai{background:#fff; color:#333; border:1px solid #eee; margin-right:auto; border-bottom-left-radius:4px;}
.chat-input{display:flex; padding:10px; border-top:1px solid #eee; background:#fff;}
.chat-input input{flex:1; padding:12px; border:1px solid #ddd; border-radius:25px; font-size:.95rem;}
.chat-input button{margin-left:8px; background:#28A745; color:#fff; border:none;
  width:40px; height:40px; border-radius:50%; cursor:pointer;}
@media(max-width:480px){
  .chat-window{width:300px;height:480px;}
  .chat-launcher{width:55px;height:55px;}
  .chat-launcher svg{width:24px;height:24px;}
  .chat-tooltip{display:none;}
}
        /* CSS from your main application's stylesheet is integrated here for consistency */
        :root {
            /* Mapped main app colors to FAQ colors for easier maintenance */
            --green: #28A745; 
            --dark-green: #218838;
            --soft: #F8F9FA; /* Light background */
            --muted: #6c757d;
            --card: #ffffff;
            --main-color: #28A745;
            --dark-text: #343A40;
        }
        * { box-sizing: border-box; margin: 0; padding: 0 }
        body {
            font-family: 'Inter', sans-serif; /* Using 'Inter' for consistency */
            background: var(--soft); color: var(--dark-text); min-height: 100vh;
            display: flex; flex-direction: column;
            line-height: 1.6;
        }
        
        /* -------------------- Header & Navigation (Slim Style) -------------------- */
.main-header {
    background-color: var(--card);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    padding: 5px 20px; /* Slimmest vertical padding */
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 50;
}

.logo {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--main-color);
    text-decoration: none;
}

.logo-icon {
    height: 24px;
    width: 24px;
    object-fit: contain; /* Ensures favicon isn't stretched */
}

.desktop-nav {
    display: none;
    gap: 12px;
}

.desktop-nav a {
    text-decoration: none;
    color: var(--dark-text);
    padding: 8px 12px;
    transition: color 0.3s;
    font-weight: 600;
}

.desktop-nav a:hover {
    color: var(--main-color);
}

/* Show desktop nav on larger screens */
@media (min-width: 768px) {
    .desktop-nav {
        display: flex;
    }
    #hamburger {
        display: none;
    }
}

        /* Hamburger Styles */
        #hamburger {
            background: none;
            border: none;
            cursor: pointer;
            display: block; 
            padding: 0;
            width: 30px;
            height: 20px;
            position: relative;
            top: 0;
        }
        .hamburger-box {
            width: 100%;
            height: 100%;
            display: block;
            position: relative;
        }
        .hamburger-inner, .hamburger-inner::before, .hamburger-inner::after {
            position: absolute;
            height: 2px;
            width: 100%;
            background-color: var(--dark-text);
            transition: transform 0.3s ease, opacity 0.3s ease;
            left: 0;
        }
        .hamburger-inner {
            top: 50%;
            transform: translateY(-50%);
        }
        .hamburger-inner::before { 
            content: '';
            top: -8px;
        }
        .hamburger-inner::after { 
            content: '';
            bottom: -8px;
        }

        /* Active state for animation */
        .hamburger.is-active .hamburger-inner { 
            transform: translateY(-50%) rotate(45deg); 
        }
        .hamburger.is-active .hamburger-inner::before { 
            opacity: 0;
        }
        .hamburger.is-active .hamburger-inner::after { 
            transform: translateY(0) rotate(-90deg);
            top: 0;
        }

        .mobile-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--card);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px 0;
            flex-direction: column;
            z-index: 45;
        }
        .mobile-menu[open] {
            display: flex;
        }
        .mobile-menu a {
            padding: 10px 20px;
            border-bottom: 1px solid #eee;
            text-decoration: none;
            color: var(--dark-text);
            font-weight: 600;
        }
        .mobile-menu a:hover {
            color: var(--main-color);
        }

        .cta-small { 
            background: var(--green); color: #fff; padding: 8px 14px; border-radius: 6px; border: none; cursor: pointer; 
            font-weight: 600;
        }
        .cta-small:hover { background: var(--dark-green); }

        /* -------------------- FAQ Content Styles -------------------- */
.faq-section {
    background: var(--card);
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    max-width: 800px;
    margin: 0 auto;
    overflow: hidden;
    box-sizing: border-box;
    width: 100%;               /* <-- NEW */
}

.faq-section h2 {
    color: var(--green);
    margin-bottom: 30px;
    font-size: 2rem;
    text-align: center;
    font-weight: 700;
    padding: 0 30px;
}

/* Inner wrapper for consistent padding */
.faq-inner {
    padding: 0 30px 30px; 
    overflow: hidden;          /* <-- NEW */
}

/* Each FAQ item */
.faq-item {
    margin-bottom: 0; 
    border-bottom: 1px solid #eee;
    padding: 0;
    overflow: hidden;
}

.faq-item summary {
    cursor: pointer;
    padding: 12px 0;
    font-weight: 600;
    color: var(--dark-text);
    font-size: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    list-style: none;
    user-select: none;
}
.faq-item summary::-webkit-details-marker { display: none; }

.faq-item summary::after {
    content: '';
    width: 0; height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid var(--green);
    transition: transform .2s ease-in-out;
    margin-left: 10px;
    flex-shrink: 0;
}

.faq-item[open] summary { 
    color: var(--main-color); 
}
.faq-item[open] summary::after { 
    transform: rotate(180deg); 
}

.faq-content {
    padding: 0 0 20px;
    font-size: .95rem;
    color: var(--muted);
    line-height: 1.5;
    overflow-wrap: break-word;   /* <-- NEW */
    word-break: normal;          /* <-- NEW */
}
.faq-content p { 
    margin-bottom: 10px; 
}
.faq-content a {
    color: var(--green);
    text-decoration: underline;
    font-weight: 600;
    word-break: break-word;      /* <-- NEW */
}
.faq-content a:hover { 
    color: var(--dark-green); 
}/* -------------------- End of FAQ Content Styles -------------------- */
        
        /* CTA Banner */
        .cta-banner {
            margin-top: 24px; background: #e6ffe6; /* Light Green */
            color: var(--dark-text); padding: 25px;
            border-radius: 12px; text-align: center; max-width: 800px; margin: 24px auto;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .cta-banner h3 {
            color: var(--dark-green);
        }
        .btn-primary {
            background: var(--green); color: #fff; padding: 10px 16px; border-radius: 6px;
            border: none; cursor: pointer; font-weight: 600; transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background: var(--dark-green);
        }
        footer {
            margin-top: 24px; padding: 20px; text-align: center; color: var(--muted);
            border-top: 1px solid #eee;
        }

        /* Media Queries */
        @media (min-width: 768px) {
            .desktop-nav { 
                display: flex;
            }
            #hamburger {
                display: none;
            }
            .container { padding-top: 100px; }
        }
        @media (max-width: 767px) {
            .faq-section { padding: 20px; }
            .faq-section h2 { font-size: 1.8rem; }
            .cta-banner div { display: flex; flex-direction: column; gap: 10px; }
            .btn-primary { margin: 5px 0 !important; width: 100%; }
        }

        .logo-container {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* FORCE TEXT TO ALIGN WITH LOGO BASELINE */
#userDisplay {
  line-height: 1;
  vertical-align: middle;
}
        
    </style>
    <div id="taxc-chat-widget">
  <div class="chat-launcher" onclick="toggleChat()" aria-label="Chat with TaxC AI">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
    <div class="chat-tooltip">Chat with Ada</div>
  </div>

  <div class="chat-window" id="chat-window">
    <div class="chat-header">
      Ada — TaxC AI
      <button class="chat-clear" onclick="clearChat()" title="Clear chat">Clear</button>
      <button class="chat-close" onclick="toggleChat()">×</button></div>
    <div class="chat-body" id="chat-body">
    </div>
    <div class="chat-input">
      <input type="text" id="chat-input" placeholder="Type here..." onkeypress="if(event.key==='Enter')sendMessage()">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
</div>
</head>
<body>

<audio id="ada-message-sound" preload="auto">
  <source src="taxcaiadamessage.mp3" type="audio/mpeg">
</audio>

    <header class="main-header">
    <div class="logo-container">
  <a class="logo" href="index.html">
    <img src="./favicon.ico" alt="TaxC Logo" class="logo-icon" style="height: 25px; margin-right: 5px; vertical-align: middle;">
    TaxC
  </a>
  <span id="userDisplay" style="display:none; color:#28A745; font-weight:600; margin-left:15px; font-size:1rem;"></span>
</div>
        <nav class="desktop-nav">
            <a href="index.html">Home</a>
            <a href="ebooks.html">Ebooks</a>
            <a href="index.html#calculator">Calculator</a>
            <button class="cta-small" id="auth-button"></button>
        </nav>
        
        <button id="hamburger" class="hamburger" onclick="toggleMobileMenu()">
            <span class="hamburger-box"><span class="hamburger-inner"></span></span>
        </button>
        
        <nav id="mobile-menu" class="mobile-menu" role="menu">
            <a href="index.html" class="nav-link">Home</a>
            <a href="ebooks.html" class="nav-link">Ebooks</a>
            <a href="index.html#calculator">Calculator</a>
            <button class="cta-small" id="auth-button-mobile"></button>
        </nav>
    </header>

    <main class="container">
    <section class="faq-section fade-in" id="faq" aria-labelledby="faq-heading">
        <h2 id="faq-heading">Frequently Asked Questions</h2>
        <div class="faq-inner">
            <details class="faq-item fade-in">
                <summary>What taxes does TaxC calculate?</summary>
                <div class="faq-content">
                    <p>TaxC calculates your Personal Income Tax (PIT) based on Nigeria’s 2025/2026 Nigerian Tax Act (NTA) rules. This includes income from salary, self-employment, rental, investments, and other sources, factoring in allowable deductions like pension contributions and rent relief (up to ₦500,000).</p>
                </div>
            </details>
            <details class="faq-item fade-in">
                <summary>Who needs to pay personal income tax in Nigeria?</summary>
                <div class="faq-content">
                    <p>Every Nigerian resident earning income above ₦800,000 annually (after deductions) is required to pay Personal Income Tax to their State Internal Revenue Service (IRS). This includes salaried employees, self-employed individuals, and those with rental or investment income.</p>
                </div>
            </details>
            <details class="faq-item fade-in">
                <summary>How does TaxC handle deductions like pension and rent?</summary>
                <div class="faq-content">
                    <p>TaxC allows you to input pension contributions and annual rent paid. For salaried or self-employed individuals, rent relief is calculated as 20% of your rent, capped at ₦500,000. These deductions reduce your taxable income, lowering your tax liability. Other deductions may include life insurance, NHF, etc.</p>
                </div>
            </details>
            <details class="faq-item fade-in">
                <summary>What is Withholding Tax (WHT), and how is it applied?</summary>
                <div class="faq-content">
                    <p>Withholding Tax (WHT) is a tax deducted at source on certain incomes, like rental income (10%), or investment income (10%). TaxC lets you input WHT paid or applies default rates, which are credited against your final tax liability to avoid double taxation.</p>
                </div>
            </details>
            <details class="faq-item fade-in">
                <summary>Is my data safe with TaxC?</summary>
                <div class="faq-content">
                    <p>Yes, TaxC prioritizes your privacy. We don’t store sensitive payment information—payments are securely handled by Interswitch. Your input data is used only for calculations and report generation, and we adhere to strict data protection standards.</p>
                </div>
            </details>
            <details class="faq-item fade-in">
                <summary>What’s included in the ₦500 PDF report?</summary>
                <div class="faq-content">
                    <p>The PDF report includes a step-by-step breakdown of your tax calculation, deduction summary (pension, rent relief, etc), tax band details, and filing guidance tailored to your state’s IRS. It’s perfect for keeping records or sharing with a tax agent.</p>
                    <p><a href="index.html#calculator">Calculate now</a> to get your report!</p>
                </div>
            </details>
            <details class="faq-item fade-in">
                <summary>How do I file my taxes after using TaxC?</summary>
                <div class="faq-content">
                    <p>TaxC provides an estimate to guide you. To file, submit your tax details to your State IRS, either online via their portal or in person. Our ₦500 report includes specific filing guidance for your state. You can also <a href="javascript:void(0)" onclick="openChat()">Chat with AI</a> for personalized help.</p>
                </div>
            </details>
            <details class="faq-item fade-in">
                <summary>Can TaxC help with company or corporate taxes?</summary>
                <div class="faq-content">
                    <p>Currently, TaxC focuses on Personal Income Tax for individuals. For corporate taxes, consult a tax professional or contact your State IRS. Our <a href="ebooks.html">eBooks</a> may offer additional resources for company owners.</p>
                </div>
            </details>
        </div>
    </section>

    <section class="cta-banner fade-in">
        <h3>Got more questions? Check ebooks or chat with AI!</h3>
        <div style="margin-top: 15px">
            <button class="btn-primary" onclick="window.location.href='ebooks.html'">Ebooks</button>
            <button class="btn-primary" style="margin-left: 10px;" onclick="openChat()">Chat with AI</button>
        </div>
    </section>
</main>

<footer class="fade-in">
    &copy; 2025 TaxC — Made with care. | <a href="mailto:support@taxc.com.ng">support@taxc.com.ng</a>
</footer>

<script>

function openChat(){
  toggleChat();                     // open the widget
  document.getElementById('chat-input').focus(); // put cursor in the box
}

// === ADA v6.0 — HACKATHON DEMO GOD MODE (Fixed Everything) ===
const Ada = {
  memory: { name: "" },
  faqs: {
    "what taxes does taxc calculate": "TaxC calculates your Personal Income Tax (PIT) based on Nigeria’s 2025/2026 Nigerian Tax Act (NTA) rules. This includes income from salary, self-employment, rental, investments, and other sources, factoring in allowable deductions like pension contributions and rent relief (up to ₦500,000).",
    "who needs to pay personal income tax": "Every Nigerian resident earning income above ₦800,000 annually (after deductions) is required to pay Personal Income Tax to their State Internal Revenue Service (IRS). This includes salaried employees, self-employed individuals, and those with rental or investment income.",
    "how does taxc handle deductions": "TaxC allows you to input pension contributions and annual rent paid. For salaried or self-employed individuals, rent relief is calculated as 20% of your rent, capped at ₦500,000. These deductions reduce your taxable income, lowering your tax liability. Other deductions may include life insurance, NHF, etc.",
    "what is withholding tax": "Withholding Tax (WHT) is a tax deducted at source on certain incomes, like rental income (10%), or investment income (10%). TaxC lets you input WHT paid or applies default rates, which are credited against your final tax liability to avoid double taxation.",
    "is my data safe": "Yes, TaxC prioritizes your privacy. We don’t store sensitive payment information—payments are securely handled by Paystack. Your input data is used only for calculations and report generation, and we adhere to strict data protection standards.",
    "what’s included in the pdf report": "The PDF report includes a step-by-step breakdown of your tax calculation, deduction summary (pension, rent relief, etc), tax band details, and filing guidance tailored to your state’s IRS. It’s perfect for keeping records or sharing with a tax agent.",
    "how do i file my taxes": "TaxC provides an estimate to guide you. To file, submit your tax details to your State IRS, either online via their portal or in person. Our ₦500 report includes specific filing guidance for your state.",
    "can taxc help with business taxes": "Currently, TaxC focuses on Personal Income Tax for individuals. For business or corporate taxes, consult a tax professional or contact your State IRS. Our eBooks may offer additional resources for business owners."
  },

  init() {
    const saved = localStorage.getItem('taxc_user_name');
    if (saved) this.memory.name = saved;
  },

  saveName(name) {
    this.memory.name = name;
    localStorage.setItem('taxc_user_name', name);
  },

  greet() {
    return this.memory.name ? `Welcome back, ${this.memory.name}! ` : "";
  },

  respond(input) {
  const l = input.toLowerCase().trim();

  // === 1. GREETINGS ===
  if (/^(hi|hello|hey|howfar|hi ada|hello ada)/i.test(input)) {
    return `Howfar! Wetin you wan know about tax?`;
  }

  // === 2. NAME ===
  if (l.includes("my name is") || l.includes("call me") || l.includes("i am")) {
    const match = input.match(/(?:my name is|call me|i am) ([\w\s]+)/i);
    if (match) {
      this.saveName(match[1].trim());
      return `Got it, ${match[1].trim()}! No wahala, I dey your back. Wetin you wan calculate?`;
    }
  }

  // === 3. DIRECT FAQ — FULL ANSWERS WITH <br> SPACING ===

  // ---- "calculate tax" ----
  if (l.includes("calculate") && l.includes("tax") || l.includes("how much") && l.includes("tax") || l.includes("owe")) {
    return `
      Let’s calculate your tax in **3 steps**:<br><br>
      1. <strong>Add income</strong> → Salary, rent, investments, etc.<br>
      2. <strong>Enter deductions</strong> → Pension, rent (up to ₦500k relief)<br>
      3. <strong>Pick your state</strong> → Click **Calculate!**<br><br>

      <button class="chat-btn" onclick="location.href='index.html#calculator'">Go to Calculator</button>
    `;
  }

  // ---- "who pays tax" ----
  if (l.includes("who") && l.includes("pay") && l.includes("tax") || l.includes("who needs to pay")) {
    return `
      Every Nigerian earning above ₦800,000 per year (after deductions) must pay **Personal Income Tax (PIT) to their State Internal Revenue Service (IRS).<br><br>

      This includes:<br>
      • Salaried employees<br>
      • Self-employed individuals<br>
      • Landlords with rental income<br>
      • Investors with dividends, interest, etc.<br><br>

      <em>Even if your employer deducts PAYE, you still file annually to reconcile.</em><br><br>

      Want to check if you owe? Let’s calculate → 
      <button class="chat-btn" onclick="location.href='index.html#calculator'">Go to Calculator</button>
    `;
  }

  // === 4. FAQ (fallback) ===
  for (const [key, answer] of Object.entries(this.faqs)) {
    const keywords = key.split(' ').filter(w => w.length > 3);
    if (keywords.some(k => l.includes(k))) {
      return `${answer} <br><br><em>You dey pay tax? No wahala, I go help you!</em>`;
    }
  }

  // === 5. FREE EBOOKS ===
  if (l.includes("free") || l.includes("ebook") || l.includes("download") || l.includes("book")) {
    return `
      I get **3 FREE eBooks** for you:
      <ul>
        <li>Who Pays Tax in Nigeria?</li>
        <li>What is P.I.T.?</li>
        <li>Am I Tax Eligible? (Quiz)</li>
      </ul>
      <button class="chat-btn" onclick="location.href='ebooks.html#free'">View All Ebooks</button>
    `;
  }

  // === 6. DEFAULT ===
  return `
    ${this.greet()}I fit help you with:
    <ul>
      <li>Who dey pay tax?</li>
      <li>How to file?</li>
      <li>Free eBooks</li>
      <li>Calculate tax</li>
    </ul>
    Just ask!
    <br><br>
    <button class="chat-btn" onclick="location.href='mailto:support@taxc.com.ng'">Contact Support</button>
  `;
} 
};

// === CHAT UI ===
let hasNewMessage = false;

function toggleChat() {
  const win = document.getElementById('chat-window');
  const launcher = document.querySelector('.chat-launcher');
  win.style.display = win.style.display === 'flex' ? 'none' : 'flex';
  if (win.style.display === 'flex') {
    hasNewMessage = false;
    launcher.classList.remove('has-notification');
    // ⭐ NEW: Clear the unread status when the chat is opened/read
    localStorage.removeItem('taxc_ai_has_unread'); 

    setTimeout(() => document.getElementById('chat-input')?.focus(), 300);
  }
}

// -------------------------------------------------
// SAVE CHAT HISTORY TO LOCALSTORAGE
// -------------------------------------------------
function saveChat() {
  const messages = [];
  document.querySelectorAll('#chat-body .message').forEach(msg => {
    messages.push({
      text: msg.innerHTML,
      type: msg.classList.contains('user') ? 'user' : 'ai'
    });
  });
  localStorage.setItem('taxc_chat_history', JSON.stringify(messages));
}

function addMessage(text, type, isInitialLoad = false) {
  const body = document.getElementById('chat-body');
  const div = document.createElement('div');
  div.className = `message ${type}`;
  div.innerHTML = text;
  body.appendChild(div);
  body.scrollTop = body.scrollHeight;
  saveChat();

  // === PLAY SOUND ONLY FOR ADA'S REAL REPLY (not loading dots) ===
  if (type === 'ai' && window.adaSound && !text.includes('typing')) {
    window.adaSound.currentTime = 0;
    window.adaSound.play().catch(() => {});
  }

  // === NOTIFICATION BUBBLE (when chat is closed) ===
  // Trigger only if it's an AI message, NOT an initial load, and the chat is closed
  if (type === 'ai' && !isInitialLoad && document.getElementById('chat-window').style.display !== 'flex') {
    hasNewMessage = true;
    document.querySelector('.chat-launcher').classList.add('has-notification');
    // ⭐ NEW: Persist the unread status in localStorage
    localStorage.setItem('taxc_ai_has_unread', 'true'); 
  }
}

// -------------------------------------------------
// CLEAR CHAT + CONFIRM
// -------------------------------------------------
function clearChat() {
  if (confirm("Are you sure you want to clear chat?")) {
    document.getElementById('chat-body').innerHTML = '';
    localStorage.removeItem('taxc_chat_history');
  }
}

function sendMessage() {
  const input = document.getElementById('chat-input');
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, 'user');
  input.value = '';
  addMessage('<i class="typing">•••</i>', 'ai');

  setTimeout(() => {
    const messages = document.querySelectorAll('.message');
    if (messages.length > 0) messages[messages.length - 1].remove();
    addMessage(Ada.respond(text), 'ai');
  }, 1000);
}

document.addEventListener('DOMContentLoaded', () => {
  Ada.init();
  
  // ⭐ NEW: Check and apply saved notification status immediately on page load
  const launcher = document.querySelector('.chat-launcher');
  if (localStorage.getItem('taxc_ai_has_unread') === 'true') {
    launcher.classList.add('has-notification');
  }

  // ==== LOAD PREVIOUS CHAT ====
  const savedChat = localStorage.getItem('taxc_chat_history');
  if (savedChat) {
    const messages = JSON.parse(savedChat);
    // Pass 'true' to ensure history re-load doesn't re-trigger notification
    messages.forEach(msg => addMessage(msg.text, msg.type, true)); 
  }

  // === INIT ADA SOUND ===
  const adaSound = document.getElementById('ada-message-sound');
  if (adaSound) {
    adaSound.volume = 0.6;
    window.adaSound = adaSound;
  }

  // ==== FIRST-TIME WELCOME (if no name & no chat) ====
  if (!Ada.memory.name && !savedChat) {
    // Pass 'true' to prevent this greeting from triggering a notification
    addMessage("Hi! I'm <strong>Ada</strong>, your personal tax assistant. Ask me anything about taxes, filing, or ebooks!", 'ai', true); 
  }

  // === ONLY SHOW "WELCOME BACK" IF NO CHAT HISTORY ===
  if (Ada.memory.name) {
    const hasChat = localStorage.getItem('taxc_chat_history') && 
                    JSON.parse(localStorage.getItem('taxc_chat_history')).length > 0;
    
    if (!hasChat) {
      setTimeout(() => {
        // Pass 'true' to prevent this greeting from triggering a notification
        addMessage(`Welcome back, ${Ada.memory.name}! Howfar today?`, 'ai', true); 
      }, 800);
    }
  }
});

// === CSS: Notification Badge + Clean Numbers ===
const style = document.createElement('style');
style.textContent = `
  .chat-btn {
    background: #28A745; color: white; border: none; padding: 10px 18px;
    border-radius: 8px; cursor: pointer; font-weight: 600; margin: 8px 0;
    display: inline-block; font-size: 0.95rem; box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    transition: all 0.2s;
  }
  .chat-btn:hover { background: #218838; transform: translateY(-1px); }

  .typing { animation: blink 1s infinite; }
  @keyframes blink { 0%,100% { opacity: 1 } 50% { opacity: 0.3 } }

  /* === FIXED: Clean Numbering === */
  .message ol {
    counter-reset: item;
    padding-left: 0;
    margin: 12px 0;
  }
  .message ol li {
    display: block;
    margin: 10px 0;
    padding-left: 30px;
    position: relative;
    line-height: 1.5;
  }
  .message ol li:before {
    content: counter(item);
    counter-increment: item;
    position: absolute;
    left: 0;
    background: #28A745;
    color: white;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 0.85rem;
  }

  /* === NOTIFICATION BADGE === */
  .chat-launcher {
    position: relative;
  }
  .chat-launcher.has-notification::after {
    content: '';
    position: absolute;
    top: 8px;
    right: 8px;
    width: 12px;
    height: 12px;
    background: #ff3b30;
    border-radius: 50%;
    border: 2px solid white;
    animation: pulse-badge 2s infinite;
  }
  @keyframes pulse-badge {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
  }
`;
document.head.appendChild(style);

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const hamburger = document.getElementById('hamburger');
            const isOpen = menu.hasAttribute('open');
            if (isOpen) {
                menu.removeAttribute('open');
                hamburger.classList.remove('is-active');
            } else {
                menu.setAttribute('open', '');
                hamburger.classList.add('is-active');
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            // This loop now only ensures the menu closes when a link is clicked,
            // relying on the <a> tag's default behavior for navigation.
            const navLinks = document.querySelectorAll('.mobile-menu a.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    // Close the menu immediately when an active link is clicked
                    toggleMobileMenu();
                });
            });
            
            // NOTE: The click event for 'hamburger' is handled by the 
            // inline 'onclick="toggleMobileMenu()"' in the HTML for simplicity.
        });

window.addEventListener('beforeunload', saveChat);

    </script>
    <script src="scripts/scroll-animation.js"></script>
    <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD59PBKVQ_ocfAxWHsMsG0a3SE143Yp5zo",
    authDomain: "taxc-ebooks.firebaseapp.com",
    projectId: "taxc-ebooks",
    storageBucket: "taxc-ebooks.firebasestorage.app",
    messagingSenderId: "542476707940",
    appId: "1:542476707940:web:591fd5d3d6fd51eff95771"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const $ = id => document.getElementById(id);

  onAuthStateChanged(auth, user => {
    const loginBtns = document.querySelectorAll('#auth-button, #auth-button-mobile');
    const userDisplay = $('userDisplay');

    if (user && user.displayName) {
      const firstName = user.displayName.split(' ')[0];
      userDisplay.textContent = `Hi, ${firstName}!`;
      userDisplay.style.display = 'inline';
    } else {
      userDisplay.style.display = 'none';
    }

    // KEEP ORIGINAL LOGIN/LOGOUT BUTTON LOGIC
    loginBtns.forEach(btn => {
      if (user) {
        btn.innerHTML = 'Logout';
        btn.onclick = () => signOut(auth).then(() => location.reload());
      } else {
        btn.innerHTML = 'Login';
        btn.onclick = () => location.href = 'login.html?redirect=' + encodeURIComponent(location.href);
      }
    });
  });
</script>
</body>
</html>